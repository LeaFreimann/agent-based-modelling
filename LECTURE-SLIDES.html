<!DOCTYPE html>
<html lang="en"><head>
<script src="day-5_files/libs/clipboard/clipboard.min.js"></script>
<script src="day-5_files/libs/quarto-html/tabby.min.js"></script>
<script src="day-5_files/libs/quarto-html/popper.min.js"></script>
<script src="day-5_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="day-5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="day-5_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="day-5_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="day-5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="day-5_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="day-5_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="day-5_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.56">

  <meta name="author" content="John McLevey">
  <meta name="author" content="Johannes B. Gruber">
  <title>Simulation &amp; Agent-based Models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="day-5_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="day-5_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #d8dee9; background-color: #2e3440; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #d8dee9; } /* Normal */
    code span.al { color: #bf616a; background-color: #3b4252; font-weight: bold; } /* Alert */
    code span.an { color: #d08770; } /* Annotation */
    code span.at { color: #8fbcbb; } /* Attribute */
    code span.bn { color: #b48ead; } /* BaseN */
    code span.bu { color: #88c0d0; font-style: italic; } /* BuiltIn */
    code span.cf { color: #81a1c1; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #ebcb8b; } /* Char */
    code span.cn { color: #eceff4; font-weight: bold; } /* Constant */
    code span.co { color: #616e88; } /* Comment */
    code span.cv { color: #e5e9f0; } /* CommentVar */
    code span.do { color: #5e81ac; } /* Documentation */
    code span.dt { color: #81a1c1; } /* DataType */
    code span.dv { color: #b48ead; } /* DecVal */
    code span.er { color: #bf616a; text-decoration: underline; } /* Error */
    code span.ex { color: #8fbcbb; font-weight: bold; } /* Extension */
    code span.fl { color: #b48ead; } /* Float */
    code span.fu { color: #88c0d0; } /* Function */
    code span.im { color: #a3be8c; } /* Import */
    code span.in { color: #ebcb8b; } /* Information */
    code span.kw { color: #81a1c1; font-weight: bold; } /* Keyword */
    code span.op { color: #81a1c1; } /* Operator */
    code span.ot { color: #8fbcbb; } /* Other */
    code span.pp { color: #5e81ac; } /* Preprocessor */
    code span.re { color: #88c0d0; background-color: #3b4252; } /* RegionMarker */
    code span.sc { color: #ebcb8b; } /* SpecialChar */
    code span.ss { color: #d08770; } /* SpecialString */
    code span.st { color: #a3be8c; } /* String */
    code span.va { color: #5e81ac; } /* Variable */
    code span.vs { color: #a3be8c; } /* VerbatimString */
    code span.wa { color: #bf616a; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="day-5_files/libs/revealjs/dist/theme/quarto.css">
  <link href="day-5_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="day-5_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="day-5_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="day-5_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Simulation &amp;<br>Agent-based Models</h1>
  <p class="subtitle"><span class="kn-pink">DAY FIVE</span> <span class="kn-blue">GESIS Fall Seminar in Computational Social Science</span></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
John McLevey 
</div>
        <p class="quarto-title-affiliation">
            University of Waterloo
          </p>
    </div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Johannes B. Gruber 
</div>
        <p class="quarto-title-affiliation">
            VU Amsterdam
          </p>
    </div>
</div>

</section>
<section class="slide level2 scrollable">

<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<h3 id="today">Today</h3>
<p>Agent-based modelling with <span class="kn-pink">Mesa</span></p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:65%;">
<ol type="1">
<li>What are agent-based <span class="nord-light">(individual-based)</span> models?<br><span class="nord-footer">From equation-based models to agent-based models<br>Example: SIR models of disease diffusion</span></li>
<li>Designing, documenting, and developing ABMs<br><span class="nord-footer">The agent-based modelling cycle</span></li>
<li>Model design concepts and pattern-oriented modelling</li>
<li>Developing your first ABM in Mesa<br><span class="nord-footer">OOP and Mesa 101<br>Extended example: developing a SIR model</span></li>
<li>Analyzing an ABM<br><span class="nord-footer">Parameter sweeps and sensitivity analysis</span></li>
<li>Social Learning, Influence, and Opinion Dynamics<br><span class="nord-footer">Bounded confidence models</span></li>
<li>Reduction, Realism, and Model Trade-offs<br><span class="nord-footer"><span class="math inline">\(\longleftarrow\)</span> Fine-grained vs.&nbsp;course-grained models <span class="math inline">\(\longrightarrow\)</span><br>What’s hot now?</span></li>
</ol>
</div></div>
</section>
<section id="section" class="slide level2 scrollable">
<h2></h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<h3 id="approach">Approach</h3>
<p>Python, R</p>
</div><div class="column" style="width:55%;">
<p>I will spend a lot of time explaining how the models are implemented in Python, but the primary <span class="kn-pink">learning objectives</span> are to</p>
<p><br></p>
<ol type="1">
<li>understand these models conceptually</li>
<li>set up their inputs and</li>
<li>analyze their outputs within a theoretical or applied context</li>
</ol>
<p><br></p>
<p><strong>If you are in the R course</strong>, focus on the logic of the Python code to better understand the models themselves; there is no expectation that you will “learn Python.” Johannes will still show you how to setup, run, and analyze these models using R.</p>
</div><div class="column" style="width:15%;">

</div></div>
</section>
<section>
<section id="what-are-agent-based-models-abms" class="title-slide slide level1 center" data-background-image="media/flocking.jpg" data-background-opacity="1">
<h1><span class="light-against-image">What are<br>Agent-based Models<br>(ABMs)?</span></h1>

</section>
<section id="what-are-abms" class="slide level2">
<h2>What are ABMs?</h2>
<p><span class="nord-footer"><span class="citation" data-cites="macy2002factors squazzoni2012agent bruch2015agent wilensky2015introduction crooks2018agent railsback2019agent smaldino2023modeling">(<a href="#/section-16" role="doc-biblioref" onclick="">Macy and Willer 2002</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Squazzoni 2012</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Bruch and Atwell 2015</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Wilensky and Rand 2015</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Crooks et al. 2018</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Smaldino 2023</a>)</span></span></p>
<p>ABMs have been central to computational social science from the start. There are plenty of good review articles, applications, and textbooks in just about any field going back 30 years or more.</p>
<p><img data-src="media/factors_to_actors.png" class="shadow-img" style="width:17.75%" alt="Sociology"> <img data-src="media/abm-polisci.png" class="shadow-img" style="width:22.0%" alt="Political Science"> <img data-src="media/abms-micro-simulation.png" class="shadow-img" style="width:21.5%" alt="Statistics"></p>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:25%;">
<p><br><br><br></p>
<h3 id="an-illustration">An Illustration</h3>
<p>SIR Models</p>
<p><span class="nord-footer">Equation vs.&nbsp;Agent-based</span></p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/kelly-sikkema-r2hTBxEkgWQ-unsplash.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Photo by Kelly Sikkema on Unsplash"><img data-src="media/kelly-sikkema-r2hTBxEkgWQ-unsplash.jpg" class="shadow-img" style="width:100.0%" alt="Photo by Kelly Sikkema on Unsplash"></a></p>
<figcaption><span class="nord-light">Photo by <a href="https://unsplash.com/@kellysikkema?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Kelly Sikkema</a> on <a href="https://unsplash.com/photos/girl-in-black-long-sleeve-shirt-reading-book-r2hTBxEkgWQ?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></span></figcaption>
</figure>
</div>
</div></div>
</section>
<section id="classic-sir" class="slide level2">
<h2>Classic SIR</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>How do diseases spread through a population?</p>
<ul>
<li>Divide the population into three “compartments”<br><strong><span class="kn-pink">S</span>usceptible</strong>, <strong><span class="kn-pink">I</span>nfected</strong>, <strong><span class="kn-pink">R</span>ecovered/Removed</strong></li>
<li>Model the movement of people in and out of the compartments in continuous time</li>
<li>Traditionally done with differential equations</li>
</ul>
<p><br></p>
<p><span class="math display">\[
\begin{align}
\frac{{dS}}{{dt}} &amp;= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &amp;= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &amp;= bI
\end{align}
\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column fragment" style="width:45%;">
<p>Don’t worry if your calculus is rusty! A <strong>derivative</strong> describes how one quantity changes in response to another quantity.</p>
<p><span class="math display">\[\frac{{d}}{{dt}}\]</span></p>
<p>is the derivative with respect to time, which represents the <strong>rate of change</strong> for a quantity given another quantity.</p>
<p><br></p>
<ul>
<li><span class="math inline">\(\frac{{dS}}{{dt}}\)</span> changes in the <span class="kn-pink">s</span><strong>usceptible</strong> compartment over time</li>
<li><span class="math inline">\(\frac{{dI}}{{dt}}\)</span> changes in the <span class="kn-pink">i</span><strong>nfected</strong> compartment over time</li>
<li><span class="math inline">\(\frac{{dR}}{{dt}}\)</span> changes in the <span class="kn-pink">r</span><strong>ecovered</strong> compartment over time</li>
</ul>
</div></div>
</section>
<section id="classic-sir-1" class="slide level2">
<h2>Classic SIR</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>How do diseases spread through a population?</p>
<ul>
<li>Divide the population into three “compartments”<br><strong><span class="kn-pink">S</span>usceptible</strong>, <strong><span class="kn-pink">I</span>nfected</strong>, <strong><span class="kn-pink">R</span>ecovered/Removed</strong></li>
<li>Model the movement of people in and out of the compartments in continuous time</li>
<li>Traditionally done with differential equations</li>
</ul>
<p><br></p>
<p><span class="math display">\[
\begin{align}
\frac{{dS}}{{dt}} &amp;= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &amp;= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &amp;= bI
\end{align}
\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<h4 id="the-susceptible-compartment">The Susceptible Compartment</h4>
<p><span class="math display">\[
\frac{{dS}}{{dt}} = - \left( \frac{{a}}{{N}}\right)  I S
\]</span></p>
<ul>
<li><span class="math inline">\(I S\)</span> means that the more infected people (<span class="math inline">\(I\)</span>) and susceptible people (<span class="math inline">\(S\)</span>) there are, the more likely it is that susceptible people will become infected.</li>
<li><span class="math inline">\(\frac{{a}}{{N}}\)</span> represents the rate at which the disease spreads in the population, where <span class="math inline">\(a\)</span> is a constant that reflects how easily the disease spreads, and <span class="math inline">\(N\)</span> is the size of the population.</li>
<li>The minus sign indicates that the number of people in this compartment will decrease as they become infected or are removed.</li>
</ul>
</div></div>
</section>
<section id="classic-sir-2" class="slide level2">
<h2>Classic SIR</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>How do diseases spread through a population?</p>
<ul>
<li>Divide the population into three “compartments”<br><strong><span class="kn-pink">S</span>usceptible</strong>, <strong><span class="kn-pink">I</span>nfected</strong>, <strong><span class="kn-pink">R</span>ecovered/Removed</strong></li>
<li>Model the movement of people in and out of the compartments in continuous time</li>
<li>Traditionally done with differential equations</li>
</ul>
<p><br></p>
<p><span class="math display">\[
\begin{align}
\frac{{dS}}{{dt}} &amp;= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &amp;= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &amp;= bI
\end{align}
\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<h4 id="the-infected-compartment">The Infected Compartment</h4>
<p><span class="math display">\[
\frac{{dI}}{{dt}} = \left( \frac{{a}}{{N}}\right)  I S - b I
\]</span></p>
<ul>
<li><span class="math inline">\(\left( \frac{{a}}{{N}}\right) I S\)</span> represents the number of people getting infected (i.e., moving from <span class="math inline">\(S\)</span> to <span class="math inline">\(I\)</span>).</li>
<li><span class="math inline">\(b\)</span> is a constant that reflects how quickly people recover.<a href="#/footnotes" class="footnote-ref" id="fnref1" role="doc-noteref" data-footnote-href="#/fn1" onclick=""><sup>1</sup></a></li>
<li><span class="math inline">\(- b I\)</span> represents the number of people recovering (moving from <span class="math inline">\(I\)</span> to <span class="math inline">\(R\)</span>).</li>
</ul>
</div></div>
<aside></aside></section>
<section id="classic-sir-3" class="slide level2">
<h2>Classic SIR</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>How do diseases spread through a population?</p>
<ul>
<li>Divide the population into three “compartments”<br><strong><span class="kn-pink">S</span>usceptible</strong>, <strong><span class="kn-pink">I</span>nfected</strong>, <strong><span class="kn-pink">R</span>ecovered/Removed</strong></li>
<li>Model the movement of people in and out of the compartments in continuous time</li>
<li>Traditionally done with differential equations</li>
</ul>
<p><br></p>
<p><span class="math display">\[
\begin{align}
\frac{{dS}}{{dt}} &amp;= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &amp;= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &amp;= bI
\end{align}
\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<h4 id="the-recovered-compartment">The Recovered Compartment</h4>
<p><span class="math display">\[
\frac{{dR}}{{dt}} = bI
\]</span></p>
<ul>
<li><span class="math inline">\(bI\)</span> shows that the number of recovered people increases as infected people recover.</li>
</ul>
</div></div>
</section>
<section id="classic-sir-4" class="slide level2">
<h2>Classic SIR</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<p><span class="math display">\[
\begin{align}
\frac{{dS}}{{dt}} &amp;= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &amp;= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &amp;= bI
\end{align}
\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>We’re just tracking the number of people in each compartment over time.</p>
<ul>
<li><span class="math inline">\(S\)</span> decreases as people get infected.</li>
<li><span class="math inline">\(I\)</span> increases as more people get infected but decreases as they recover.</li>
<li><span class="math inline">\(R\)</span> increases as people recover from the infection.</li>
</ul>
</div></div>
</section>
<section id="sir-in-discrete-time" class="slide level2">
<h2>SIR in Discrete Time</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>We can represent the same basic model of changes in the number of people in each compartment <em>in discrete time intervals</em> <span class="nord-light">(which makes it easier to simulate with agent-based models)</span></p>
<p><span class="math display">\[
\begin{align}
S(t + 1) &amp;= S(t) - \beta S(t)I(t) \\
I(t + 1) &amp;= I(t) + \beta S(t)I(t) - \gamma I(t) \\
R(t + 1) &amp;= R(t) + \gamma I(t)
\end{align}
\]</span></p>
<p><br></p>
<p><strong>Some Model Assumptions</strong> <span class="math inline">\(\longrightarrow\)</span></p>
<p><a href="media/smaldino.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="media/smaldino.jpg" class="shadow-img" style="width:30.0%"></a></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<blockquote>
<p>These equations define how the relative numbers of susceptible, infected, and recovered individuals change over time, and represent two propositions about disease contagion. <span class="kn-pink">First</span>, that susceptible individuals become infected via contact with infected individuals, at a rate that is proportional to the expected number of interactions between susceptible and infected individuals, tempered by the transmissibility of the infection, <span class="math inline">\(β\)</span>. <span class="kn-pink">Second</span>, that infected individuals recover at a constant rate, <span class="math inline">\(γ\)</span>.</p>
<p><br></p>
<p>An <span class="kn-pink">implicit assumption</span> is that the rate of interactions between individuals in different states is exactly proportional to the frequencies of those states in the population—that is, that the population is <span class="kn-pink">well-mixed</span>.</p>
<p><br></p>
<p><span class="citation" data-cites="smaldino2023modeling">Smaldino (<a href="#/section-16" role="doc-biblioref" onclick="">2023</a>)</span>, page 18</p>
</blockquote>
</div></div>
</section>
<section id="mixing-and-flattening-the-curve" class="slide level2">
<h2>Mixing and Flattening the Curve</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:55%;">
<p>Reducing physical contact reduces the <strong>effective transmission rate</strong> of a disease, which has a big impact on the number of sick people in a population.</p>
<div id="fig-sir_compare_models_1-2" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-sir_compare_models_1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/sir_compare_models_1-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;1: Proportion of infected people in a population over time from two SIR simulations with different transmissability rates. We’ll develop the model this figure comes from later in the lecture."><img data-src="media/sir_compare_models_1-2.png" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sir_compare_models_1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Proportion of infected people in a population over time from two SIR simulations with different transmissability rates. <span class="nord-light">We’ll develop the model this figure comes from later in the lecture.</span>
</figcaption>
</figure>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:40%;">
<p><br><br><br></p>
<h4 id="m-people-in-ontario-canada-as-of-2024">~14.4M people in Ontario, Canada <span class="nord-light">(as of 2024)</span></h4>
<!--
```python
#| echo: false
import yaml
with open('_variables.yml', 'r') as file:
    variables = yaml.safe_load(file)
```
-->
<ul>
<li>A peak at <code>{python} variables['results_sir_model_1_max_infected']</code> in the high-transmissability model <span class="math inline">\(\approx\)</span> <code>{python} round(variables['ontario_population'] * variables['results_sir_model_1_max_infected'], 2)</code>M infected people</li>
<li>A peak at <code>{python} variables['results_sir_model_2_max_infected']</code> in the low-transmissability model <span class="math inline">\(\approx\)</span> <code>{python} round(variables['ontario_population'] * variables['results_sir_model_2_max_infected'], 2)</code>M infected people</li>
</ul>
<p>A <code>{python} round(variables['results_sir_model_1_max_infected']-variables['results_sir_model_2_max_infected'], 4)*100</code>% difference translates to <span class="math inline">\(\approx\)</span> <code>{python} round(variables['ontario_population']*variables['results_sir_model_1_max_infected'])-round(variables['ontario_population']*variables['results_sir_model_2_max_infected'])</code>M infected people <strong>at that particular moment in time</strong>.</p>
</div></div>
</section>
<section id="mixing-and-flattening-the-curve-1" class="slide level2">
<h2>Mixing and Flattening the Curve</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/anthony-delanoix-hzgs56Ze49s-unsplash.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Imagine agents moving around the simulated world the way we move around the real world. Photo by Anthony DELANOIX on Unsplash"><img data-src="media/anthony-delanoix-hzgs56Ze49s-unsplash.jpg" class="shadow-img" style="width:85.0%" alt="Imagine agents moving around the simulated world the way we move around the real world. Photo by Anthony DELANOIX on Unsplash"></a></p>
<figcaption>Imagine agents moving around the simulated world the way we move around the real world. <span class="nord-light">Photo by <a href="https://unsplash.com/@anthonydelanoix?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Anthony DELANOIX</a> on <a href="https://unsplash.com/photos/person-performing-heart-hand-gesture-hzgs56Ze49s?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></span></figcaption>
</figure>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:50%;">
<div id="fig-compare_agent_step_sizes" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-compare_agent_step_sizes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/compare_agent_step_sizes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;2: The space covered by an agent who can take as many as 8 steps is much greater than the space covered by an agent who can only take 1. The grid is toroidal, which means all four edges wrap to each other."><img data-src="media/compare_agent_step_sizes.png" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-compare_agent_step_sizes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The space covered by an agent who can take as many as 8 steps is much greater than the space covered by an agent who can only take 1. The grid is <strong>toroidal</strong>, which means all four edges wrap to each other.
</figcaption>
</figure>
</div>
</div></div>
<!--
## Mixing and Flattening the Curve

[More movement = more mixing = more exposures = more infections.]{.kn-pink}

But there are some qualifications that will come up a bit later in the lecture.

<br>

:::: {.columns}
::: {.column width="45%"}
#### Shared Parameters

| Parameter             | Value                        |
|-----------------------|------------------------------|
| N                   | 150        |
| grid_height         | 40 |
| grid_width          | 40 |
| infection_rate      | 0.15 |
| n_initial_infections| 2 |
| n_iterations        | 100 |
| recovery_time_range | (7, 14)                      |

:::

::: {.column width="55%"}
![](media/sir_compare_models_3-6.png){width=42% #sir_compare_models_3-6} &nbsp;&nbsp;&nbsp; ![](media/compare_agent_networks.png){width=36% #fig-compare_agent_networks}

[@sir_compare_models_3-6 (left) Two SIR models with identical parameters other than max agent step size. @fig-compare_agent_networks (right) edge weight ECDF.]{.small-text}

<br>

|    |   No. Nodes |   No. Edges |   Avg. Degree |
|:---|------------:|------------:|--------------:|
| M1 |         100 |         984 |         19.68 |
| M2 |         100 |         997 |         19.94 |


:::
::::
 -->
</section>
<section id="equation-vs.-agent-based-models" class="slide level2">
<h2>Equation vs.&nbsp;Agent-based Models</h2>
<p><br><br><br></p>
<p>Unlike equation-based models of systems, ABMs</p>
<ul>
<li>do not rely on aggregated variables to represent system components</li>
<li>emphasize heterogeneity by directly representing individual agents and their iteractions</li>
<li>focuses on emergent outcomes and contextualized adaptive behaviours</li>
<li>are not contrained by mathematical tractability</li>
<li>etc.</li>
</ul>
</section>
<section id="section-2" class="slide level2 scrollable">
<h2></h2>
<p><span class="nord-footer"><span class="citation" data-cites="railsback2019agent">(<a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>)</span></span></p>
<h3 id="what-is-the-agent-based-modelling-cycle">What is the agent-based modelling cycle?</h3>
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<div id="fig-abm-cycle" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-abm-cycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/abm-cycle.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;3: The ABM modelling cycle is a great fit with the Box and Wickham loops we’ve mentioned repeatedly throughout the course. Figure reproduced from @railsback2019agent."><img data-src="media/abm-cycle.png" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-abm-cycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The ABM modelling cycle is a great fit with the Box and Wickham loops we’ve mentioned repeatedly throughout the course. <span class="nord-light">Figure reproduced from <span class="citation" data-cites="railsback2019agent">Railsback and Grimm (<a href="#/section-16" role="doc-biblioref" onclick="">2019</a>)</span>.</span>
</figcaption>
</figure>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:50%;">
<div class="fragment">
<ol type="1">
<li>Formulate the question</li>
</ol>
</div>
<div class="fragment">
<ol start="2" type="1">
<li>Assemble hypotheses for essential processes and structure</li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li>Choose model structure<br><span class="nord-footer">(scales, entities, state variables, processes, and parameters)</span></li>
</ol>
</div>
<div class="fragment">
<ol start="4" type="1">
<li>Implement the model</li>
</ol>
</div>
<div class="fragment">
<ol start="5" type="1">
<li>Analyze, test, and revise the model<br><span class="nord-footer">(recall the Box and Wickham loops!)</span></li>
</ol>
</div>
<div class="fragment">
<ol start="6" type="1">
<li>Communicate the model</li>
</ol>
</div>
</div></div>
<p>We’ll talk about <span class="kn-pink">patterns</span> and the role they play in modelling shortly.</p>
<aside class="notes">
<p>The modeling cycle is a systematic and iterative process used to develop, implement, analyze, and refine <strong>scientific</strong> agent-based models. This cycle is essential for ensuring that models are well-designed, accurately reflect the system they are meant to represent, and are useful for answering specific research questions. The cycle typically involves the following key steps:</p>
<ol type="1">
<li><strong>Formulate the Question</strong>
<ul>
<li><strong>Purpose:</strong> The first step is to clearly define the research question that the model is intended to answer. This question acts as a guiding principle for the entire modeling process, helping to determine which aspects of the real system should be included or excluded in the model.</li>
<li><strong>Importance:</strong> A well-defined question ensures that the model remains focused and relevant. It also serves as a filter, helping to decide which factors in the real system are important for the model and which can be ignored.</li>
<li><strong>Challenges:</strong> Formulating a clear question can be difficult, especially in complex systems where multiple factors are interrelated. Often, the question may need to be refined as the modeling process progresses.</li>
</ul></li>
<li><strong>Assemble Hypotheses for Essential Processes and Structures</strong>
<ul>
<li><strong>Purpose:</strong> Once the question is formulated, the next step is to hypothesize which processes and structures within the system are essential to address the research question. This involves identifying the key factors that drive the system’s behavior and determining how these factors interact.</li>
<li><strong>Top-Down and Bottom-Up Approaches:</strong> This step can be approached in two ways:
<ul>
<li><strong>Top-Down:</strong> Consider the major influences on the phenomena of interest and how they might interact.</li>
<li><strong>Bottom-Up:</strong> Start with basic components and build up to more complex interactions.</li>
</ul></li>
<li><strong>Simplification:</strong> It is crucial to start with the simplest possible model that still addresses the research question. Simplification helps in quickly implementing and testing the model, which is more productive than starting with a complex model that is difficult to manage.</li>
</ul></li>
<li><strong>Choose Scales, Entities, State Variables, Processes, and Parameters</strong>
<ul>
<li><strong>Purpose:</strong> In this step, the specific details of the model are defined. This includes determining the scale at which the model operates (e.g., temporal and spatial scales), identifying the entities involved (e.g., agents in an ABM), and selecting the state variables that describe these entities (e.g., position, health status).</li>
<li><strong>Model Structure:</strong> The model’s structure is outlined, including how different entities interact with each other and with their environment. This is often documented in a written formulation, which serves as a blueprint for the model.</li>
<li><strong>Importance:</strong> A clear and detailed model structure is essential for successful implementation and later analysis. It also aids in communicating the model to others, such as collaborators or reviewers.</li>
</ul></li>
<li><strong>Implement the Model</strong>
<ul>
<li><strong>Purpose:</strong> The verbal or written description of the model is translated into a computer program or mathematical framework. This involves using appropriate tools and platforms, such as NetLogo for agent-based models, to bring the model to life.</li>
<li><strong>Challenges:</strong> Implementation can be technically demanding, especially for beginners. However, using established software platforms can greatly simplify this task and reduce the time required to develop a functioning model.</li>
<li><strong>Rightness of Implementation:</strong> The implementation itself is always “right” in the sense that it accurately represents the assumptions encoded in the model, allowing for the rigorous exploration of these assumptions.</li>
</ul></li>
<li><strong>Analyze, Test, and Revise the Model</strong>
<ul>
<li><strong>Purpose:</strong> After implementation, the model is analyzed to see if it behaves as expected and whether it provides useful insights into the research question. This involves testing the model’s predictions against real-world data, conducting sensitivity analyses, and iterating on the model’s design to improve its accuracy and relevance.</li>
<li><strong>Iteration:</strong> This step is the most time-consuming and involves repeated cycles of testing and refining the model. As the model is analyzed, new insights may lead to revisions in the model’s structure, assumptions, or parameters.</li>
<li><strong>Importance:</strong> This step is crucial for validating the model and ensuring that it provides reliable answers to the research question. It also helps to identify and correct any oversimplifications or inaccuracies in the initial model.</li>
</ul></li>
<li><strong>Communicate the Model</strong>
<ul>
<li><strong>Purpose:</strong> The final step involves sharing the model and its findings with the scientific community, policymakers, or other stakeholders. This can include publishing the model in a scientific journal, presenting it at conferences, or providing reports to decision-makers.</li>
<li><strong>Documentation:</strong> Communication also involves thoroughly documenting the model and the results of its analysis. This documentation is vital for transparency, reproducibility, and for others to understand and build upon the work.</li>
<li><strong>Feedback:</strong> Sharing the model often leads to feedback, which can further refine the model or suggest new directions for research.</li>
</ul></li>
</ol>
<p>The modeling cycle is inherently <strong>iterative</strong> and focuses on <strong>continuous imporvement</strong>. It is rare to go through the entire cycle only once; instead, modelers often loop back to earlier steps as new insights are gained. For example, the initial research question might be refined based on what is learned during model analysis, leading to adjustments in hypotheses or model structure. This iterative nature allows for continuous improvement of the model, making it more accurate and useful over time.</p>
<p>Throughout the modeling cycle, there is an emphasis on <strong>starting simple and adding complexity only when necessary</strong>. This is based on the principle that simpler models are easier to implement, test, and understand. As the model progresses through the cycle, additional factors can be introduced gradually, allowing for a better understanding of their impact on the system.</p>
<p>In short, the modeling cycle is a structured approach to developing scientific models that involves formulating a clear question, hypothesizing essential processes, designing and implementing the model, analyzing and refining it, and finally communicating the results. This iterative process ensures that models are both scientifically rigorous and practically useful for addressing complex research questions.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p><span class="nord-footer"><span class="citation" data-cites="railsback2019agent">(<a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>)</span></span></p>
<h3 id="how-do-we-design-document-and-develop-abms">How do we design, document, and develop ABMs?</h3>
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<p><strong>Explicit</strong> model formulations are <strong>essential</strong> for understanding and thinking clearly about the model, implementing it in code, learning from it, and communicating it to others. In ABM, especially in the social and ecological sciences, this follows the <strong>ODD protocol</strong> <span class="nord-light">(Overview, Design concepts, and Details)</span>, which provides a structured and systematic way to formulate, describe, and communicate ABMs, ensuring that the models are clear, complete, and reproducible.</p>
<p><br></p>
<p>ODD is not only a tool for final documentation; it serves as a framework for the iterative development of the model and an initial version should be developed <em>before</em> you start implementing your ideas! For many reasons, this makes implementation <strong>much</strong> easier and more efficient.</p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div id="fig-odd" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-odd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/odd.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;4: High-level structure of the ODD protocol. Figure reproduced from @railsback2019agent, which was revised from @grimm2010odd."><img data-src="media/odd.png" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-odd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: High-level structure of the ODD protocol. <span class="nord-light">Figure reproduced from <span class="citation" data-cites="railsback2019agent">Railsback and Grimm (<a href="#/section-16" role="doc-biblioref" onclick="">2019</a>)</span>, which was revised from <span class="citation" data-cites="grimm2010odd">Grimm et al. (<a href="#/section-16" role="doc-biblioref" onclick="">2010</a>)</span>.</span>
</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>ODDs have the following high-level components:</p>
<ul>
<li>Purpose and Patterns: The model’s purpose is defined clearly, specifying what the model is for and what patterns it should reproduce to be considered realistic.</li>
<li>Entities, State Variables, and Scales: These outline the types of entities (e.g., agents, environment) in the model, the variables that characterize them, and the temporal and spatial scales used in the model.</li>
<li>Process Overview and Scheduling: This describes the processes that govern the dynamics of the model (e.g., agent behaviors) and how these processes are scheduled over time.</li>
<li>Design Concepts: This section covers basic principles, emergence, adaptation, and other design concepts essential for understanding how the model works. We will come back to the idea of design concepts later in the lecture.</li>
<li>Initialization: How the model is set up at the beginning of a simulation, including the initial state of agents and environment.</li>
<li>Input Data: Describes external data inputs that change over time and are used in the model.</li>
<li>Submodels: Detailed descriptions of the submodels that represent specific processes within the ABM.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="what-are-model-design-concepts" class="slide level2">
<h2>What are <span class="kn-pink">model design concepts</span>?</h2>
<p>Model design concepts are an important part of the ODD protocol. What are they, exactly?</p>
<p><br></p>
<!-- design-concepts-questions.png -->
<div class="columns">
<div class="column" style="width:25%;">
<p><br></p>
<ul>
<li>Emergence</li>
<li>Observation</li>
<li>Sensing</li>
<li>Adaptive Behaviour and Objectives</li>
<li>Prediction</li>
<li>Interaction</li>
<li>Scheduling</li>
<li>Stochasticity</li>
<li>Collectives</li>
</ul>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:70%;">
<blockquote>
<p>Each time you build an ABM, you need to think about how each of these concepts is addressed, if it is, in the model. Why? The first reason is to make sure that you think about all the important model design issues and decide explicitly how to handle each. Otherwise, important parts of the model’s design could be determined accidentally or only by programming convenience, and your model will seem ad hoc and unscientific. The second reason is to make it easier to describe your model to others. When modelers use the ODD protocol and these design concepts to describe ABMs, it is much easier for others to understand the model’s most important characteristics. Not all of the concepts will be important to each ABM, but thinking about each of the concepts helps you convince yourself and others that all the important model design decisions were made explicitly and carefully. (For this reason, the design concepts are also very useful when you review someone else’s ABM.)</p>
<p><span class="citation" data-cites="railsback2019agent">Railsback and Grimm (<a href="#/section-16" role="doc-biblioref" onclick="">2019</a>)</span>, pp.&nbsp;99-100</p>
</blockquote>
</div></div>
<aside class="notes">
<ul>
<li><strong>Emergence</strong> refers to the patterns, behaviors, or outcomes that arise from the interactions of individual agents within the model. These emergent properties are not directly programmed into the model but instead result from the collective dynamics of the agents. Understanding and analyzing these emergent phenomena are often the primary goals of using ABMs.
<ul>
<li><em>In the SIR model, the emergent behavior is the epidemic curve that shows how the disease spreads through the population over time, leading to waves of infection, recovery, and potential stabilization.</em></li>
</ul></li>
<li><strong>Observation</strong> involves how the model’s outcomes are recorded and analyzed. This concept includes specifying what data will be collected from the model during its execution, such as the number of agents in different states, spatial distributions, or interaction networks. The way observations are made can significantly influence the interpretation of the model’s results.
<ul>
<li><em>In the SIR model, observation is carried out by collecting data on the number of infected, susceptible, and recovered agents at each time step, as well as the duration of infections and the interactions between agents.</em></li>
</ul></li>
<li><strong>Sensing</strong> describes the information that agents can perceive about their environment and other agents. It includes what variables the agents are aware of, such as the state of nearby agents or environmental conditions, and how accurately they sense this information. The sensing capability of agents influences their decision-making and behavior. In some cases, agents may not really be “aware,” such as in a model of infectious disease diffusion.
<ul>
<li><em>In the SIR model, agents “sense” the state of neighboring agents (whether they are susceptible or infected), which influences their likelihood of becoming infected if they are susceptible.</em></li>
</ul></li>
<li><strong>Adaptive behavior</strong> refers to the way agents modify their actions in response to changes in their environment or internal state. Objectives are the goals that agents seek to achieve, such as maximizing fitness, utility, or survival. In ABMs, agents often make decisions that adapt their behavior to better achieve these objectives.
<ul>
<li><em>In the SIR model, agents do not exhibit adaptive behavior in the traditional sense; they follow predefined rules for movement and infection based on their current state and interactions.</em></li>
</ul></li>
<li><strong>Prediction</strong> involves how agents anticipate future conditions or outcomes based on their current state and environment. In some models, agents may have internal mechanisms that allow them to predict the future and adjust their behavior accordingly, while in others, predictions might be implicit in the rules governing agent actions.
<ul>
<li><em>In the SIR model, agents do not explicitly predict future conditions; their actions are based on immediate interactions with neighbors rather than anticipating future states.</em></li>
</ul></li>
<li><strong>Interaction</strong> refers to the ways in which agents influence each other and their environment. This can include direct interactions, such as communication or physical contact, or indirect interactions, such as competition for resources. The nature and frequency of interactions among agents are key determinants of the emergent properties of the model.
<ul>
<li><em>In the SIR model, interactions occur when infected agents come into contact with susceptible agents, potentially spreading the infection based on a predefined infection rate.</em></li>
</ul></li>
<li><strong>Scheduling</strong> is about the order and timing of agent actions and processes within the model. It defines how agents’ actions are sequenced, whether they are updated simultaneously or sequentially, and how time is represented in the model. The schedule can have a significant impact on the dynamics and outcomes of the simulation.
<ul>
<li><em>In the SIR model, scheduling determines the order in which agents move, interact, and possibly change their health state (susceptible, infected, or recovered) during each time step of the simulation.</em></li>
</ul></li>
<li><strong>Stochasticity</strong> involves the inclusion of randomness in the model. This can be in the form of random events, variations in agent behavior, or random initialization of agent states. Stochastic processes are used to represent uncertainty, variability, or incomplete knowledge about the system being modeled.
<ul>
<li><em>In the SIR model, stochasticity is present in the random movement of agents, the random infection transmission based on probability, and the random timing of recovery within a specified range.</em></li>
</ul></li>
<li><strong>Collectives</strong> refer to groups of agents that form higher-level entities within the model. These groups may have their own behaviors and characteristics, distinct from those of individual agents. Collectives can emerge from the interactions of agents or be explicitly defined, and they often play a crucial role in the dynamics of the system.
<ul>
<li><em>In the SIR model, there are no explicit collectives; however, the interactions among agents can lead to clusters of infection, which can be viewed as an emergent collective behavior.</em></li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-4" class="slide level2 scrollable" data-background-color="#F0F0F0">
<h2></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div style="background-color: white; padding: 80px; width: 75%; height: 600px; overflow-y: scroll; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
<h3 id="purpose-and-patterns">1. Purpose and Patterns</h3>
<p><br></p>
<h4 id="purpose">Purpose</h4>
<p>The purpose of this model is to simulate the spread of an infectious disease through a population using a Susceptible-Infected-Recovered (SIR) framework. The model aims to explore how different factors such as infection rate, recovery time, and agent mobility affect the dynamics of disease spread and the overall infection rate in a population.</p>
<p><br></p>
<h4 id="patterns">Patterns</h4>
<p>The model is intended to replicate the typical patterns observed in infectious disease spread, such as:</p>
<ul>
<li>The rapid increase in the number of infected individuals (an epidemic curve).</li>
<li>The eventual decline in the number of infections as individuals recover.</li>
<li>The effect of varying recovery times and movement speeds on the spread of the disease.</li>
<li>The impact of initial infection rates on the overall dynamics of the disease.</li>
</ul>
<h3 id="entities-state-variables-and-scales">2. Entities, State Variables, and Scales</h3>
<p><br></p>
<h4 id="entities">Entities</h4>
<ul>
<li><strong>Agents:</strong> The model consists of agents representing individuals in the population. Each agent can be in one of three states: Susceptible (S), Infected (I), or Recovered (R). Agents move around the grid and interact with each other, potentially spreading the infection.</li>
<li><strong>Environment:</strong> The environment is a grid where agents move and interact. The grid is defined by a width and height, and the movement of agents is confined within this grid.</li>
</ul>
<p><br></p>
<h4 id="state-variables">State Variables</h4>
<ul>
<li><strong>For Agents:</strong>
<ul>
<li><strong>state</strong>: The current health state of the agent (S, I, or R).</li>
<li><strong>infected_time</strong>: The time the agent has been infected.</li>
<li><strong>recovery_time_range</strong>: The range within which the agent might recover from the infection.</li>
<li><strong>max_agent_step_size</strong>: The maximum distance an agent can move in one step.</li>
<li><strong>pos_history</strong>: The history of positions the agent has occupied.</li>
<li><strong>interactions</strong>: A record of interactions with other agents.</li>
<li><strong>infection_duration</strong>: The total duration the agent has been infected.</li>
</ul></li>
<li><strong>For the Environment:</strong>
<ul>
<li>The environment does not have dynamic state variables but is characterized by its dimensions (<strong>grid_width</strong> and <strong>grid_height</strong>).</li>
</ul></li>
</ul>
<p><br></p>
<h4 id="scales">Scales</h4>
<ul>
<li><strong>Temporal Scale:</strong> The model operates in discrete time steps. Each step represents one unit of time, during which agents move and potentially interact with others.</li>
<li><strong>Spatial Scale:</strong> The environment is a discrete grid where each cell can hold multiple agents. The grid’s size is defined by the parameters <strong>grid_width</strong> and <strong>grid_height</strong>, which are set in the file <strong>_variables.qmd</strong>.</li>
</ul>
<h3 id="process-overview-and-scheduling">3. Process Overview and Scheduling</h3>
<p><br></p>
<h4 id="process-overview">Process Overview</h4>
<ul>
<li><strong>Agent Movement:</strong> Each agent moves to a new location within its movement range (<strong>max_agent_step_size</strong>). The new position is randomly chosen from neighboring cells.</li>
<li><strong>Infection Spread:</strong> Infected agents attempt to infect neighboring susceptible agents with a probability defined by the infection rate.</li>
<li><strong>Recovery:</strong> Infected agents have a chance to recover based on the time they have been infected. The recovery time is determined by the <strong>recovery_time_range</strong>.</li>
</ul>
<p><br></p>
<h4 id="scheduling">Scheduling</h4>
<ul>
<li>At each time step, the following processes occur:
<ol type="1">
<li><strong>Data Collection:</strong> The model records the current state of the system (e.g., the number of infected agents).</li>
<li><strong>Agent Actions:</strong> Each agent, in random order, executes the <strong>step()</strong> method, which includes moving, attempting to infect others, and potentially recovering.</li>
<li><strong>Iteration Control:</strong> The model checks if the stopping conditions (maximum iterations or change in infection ratio) are met to decide whether to continue running.</li>
</ol></li>
</ul>
<h3 id="design-concepts">4. Design Concepts</h3>
<ul>
<li><strong>Basic Principles:</strong> The model follows the basic principles of the SIR framework, where agents transition between susceptible, infected, and recovered states based on interactions with others and time spent infected.</li>
<li><strong>Emergence:</strong> The primary emergent behavior is the epidemic curve showing how the number of infections grows, peaks, and declines over time.</li>
<li><strong>Adaptation:</strong> Agents do not adapt; their behavior is determined by the rules of movement, infection, and recovery.</li>
<li><strong>Objectives:</strong> The model’s objective is to simulate disease spread dynamics and analyze the effects of different parameters on the spread.</li>
<li><strong>Learning:</strong> Agents do not learn or change behavior over time.</li>
<li><strong>Prediction:</strong> Agents do not predict future states; they act based on their current state and the states of their neighbors.</li>
<li><strong>Sensing:</strong> Agents “sense” the state of other agents in their immediate neighborhood (Moore neighborhood).</li>
<li><strong>Interaction:</strong> Interaction occurs when infected agents are in proximity to susceptible agents, leading to potential infection.</li>
<li><strong>Stochasticity:</strong> The model includes randomness in agent movement, infection transmission, and recovery timing.</li>
<li><strong>Collectives:</strong> No explicit collectives are modeled.</li>
<li><strong>Observation:</strong> The model tracks the number of infected agents over time and can output interaction graphs to analyze agent interactions.</li>
</ul>
<h3 id="initialization">5. Initialization</h3>
<ul>
<li><strong>Agent Initialization:</strong> The model begins with <strong>N</strong> agents randomly placed on the grid. A specified number of agents (<strong>n_initial_infections</strong>) are initially infected.</li>
<li><strong>Environment Initialization:</strong> The environment is a grid of size <strong>grid_width</strong> x <strong>grid_height</strong>. The grid is toroidal, meaning agents moving off one edge appear on the opposite edge.</li>
<li><strong>Initial Conditions:</strong> Agents are placed with a random state of “S” (susceptible), except for the initially infected agents. The agents’ recovery times are set within the specified <strong>recovery_time_range</strong>.</li>
</ul>
<h3 id="input-data">6. Input Data</h3>
<ul>
<li>The model does not use external input data during the simulation. All necessary parameters are set at initialization.</li>
</ul>
<h3 id="submodels">7. Submodels</h3>
<ul>
<li><strong>Movement Submodel:</strong> Each agent selects a random neighboring cell within its movement range (<strong>max_agent_step_size</strong>) and moves there. The movement is subject to the boundaries of the grid.</li>
<li><strong>Infection Submodel:</strong> If an agent is infected, it attempts to infect neighboring susceptible agents with a probability equal to the <strong>infection_rate</strong>.</li>
<li><strong>Recovery Submodel:</strong> Infected agents track their infection duration and attempt to recover based on their <strong>recovery_time_range</strong>. Agents have a 50% chance of recovery after the minimum recovery time is reached, and they automatically recover if the maximum time is exceeded.</li>
</ul>
</div>
</div><div class="column" style="width:25%;">
<p>ODD Protocol for SIR Model<br><span class="math inline">\(\longleftarrow\)</span></p>
<p><br></p>
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/odd.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure reproduced from @railsback2019agent."><img data-src="media/odd.png" class="shadow-img" style="width:100.0%" alt="Figure reproduced from Railsback and Grimm (2019)."></a></p>
<figcaption><span class="nord-light">Figure reproduced from <span class="citation" data-cites="railsback2019agent">Railsback and Grimm (<a href="#/section-16" role="doc-biblioref" onclick="">2019</a>)</span>.</span></figcaption>
</figure>
</div>
</div></div>
</section>
<section id="what-is-pattern-oriented-modelling" class="slide level2">
<h2>What is <span class="kn-pink">pattern-oriented modelling</span>?</h2>
<p><span class="nord-light"><span class="citation" data-cites="railsback2019agent">(<a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>)</span></span></p>
<div class="columns">
<div class="column" style="width:45%;">
<p>Credible scientific models must be capable of reproducing multiple <span class="nord-light">(ideally diverse)</span> observed patterns from the systems we want to model <strong>without overfitting</strong> to any given pattern.</p>
<p><a href="media/lego-bridge.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img data-src="media/lego-bridge.png" class="shadow-img" style="width:100.0%"></a></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/flocking.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system. Models of birds flocking and fish schooling are common examples in interdisciplinary introductions, and it’s not really a lecture about agent-based modelling if there isn’t at least one picture of birds flocking…"><img data-src="media/flocking.jpg" class="shadow-img" style="width:100.0%" alt="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system. Models of birds flocking and fish schooling are common examples in interdisciplinary introductions, and it’s not really a lecture about agent-based modelling if there isn’t at least one picture of birds flocking…"></a></p>
<figcaption>Like generative network analysis, the high-level objective is to deepen our understanding of the <strong>latent processes governing the system</strong>. Models of birds flocking and fish schooling are common examples in interdisciplinary introductions, and it’s not really a lecture about agent-based modelling if there isn’t at least one picture of birds flocking…</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>Pattern-oriented modeling (POM) is a strategy in the development and testing of agent-based models (ABMs) that uses multiple observed patterns from the real world to guide the design of the model’s structure and to validate its results. This approach aims to ensure that the model is not only structurally realistic but also capable of reproducing various patterns observed in the system it represents.</p>
<p>In POM, the focus is on identifying and reproducing multiple, often diverse, patterns that characterize the system being modeled. These patterns can include spatial patterns, temporal dynamics, and other system behaviors observed in the real world. The rationale behind using multiple patterns is to avoid overfitting the model to a single pattern, which might lead to incorrect conclusions or predictions. By requiring the model to replicate multiple observed patterns, POM helps in selecting and refining the model’s structure and mechanisms, ensuring that the model’s behavior is not just an artifact of a particular parameter setting or assumption but is rooted in the actual processes governing the system.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="what-is-pattern-oriented-modelling-1" class="slide level2">
<h2>What is <span class="kn-pink">pattern-oriented modelling</span>?</h2>
<p><span class="nord-light">Patterns for Model Structure <span class="citation" data-cites="railsback2019agent">(<a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>)</span></span></p>
<div class="columns">
<div class="column" style="width:45%;">
<p>These <strong>real-world patterns</strong> can take many forms, such as spatial distributions, temporal sequences, or system-level properties. We want to observe and document patterns from empirical data, prior research, etc. and then use them to guide the design of the model structure. They is to select and organize our entities, processes, and interactions in a way that the model is capable of generating the observed patterns.</p>
<p><br></p>
<p>In the <strong>SIR model example</strong>, the key <strong>patterns</strong> are observed epidemic behaviors, such as the rise and fall of infected individuals over time, especially the occurrence of an infection peak. These are incorporated into the SIR model via the transmission rate <span class="math inline">\(\beta\)</span> <span class="nord-light">(simulating infection spread)</span> and recovery rate <span class="math inline">\(\gamma\)</span> <span class="nord-light">(simulating recovery)</span>. If the model can’t reproduce the observed epidemic behaviours, we <strong>refine</strong> it.</p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/sir_compare.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system."><img data-src="media/sir_compare.png" class="shadow-img" style="width:100.0%" alt="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system."></a></p>
<figcaption>Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system.</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>We have to <strong>identify</strong>, observe, and document patterns from empirical data, prior research, etc. Then we have to <strong>use these patterns to guide the design of model structure</strong> such that the entities, processes, and interactions in the model are selected and organized in a way that allows the model to generate the observed patterns.</p>
<p>In the context of the <strong>SIR model</strong>, patterns refer to the observed behaviors of an epidemic, such as the rise and fall in the number of infected individuals over time or the eventual stabilization of the population into susceptible and recovered groups. One important observed pattern in many infectious diseases is the occurrence of a peak in the number of infected individuals. This peak represents the point at which the disease is spreading most rapidly, after which the number of new infections begins to decline as more individuals either recover or remain uninfected due to the declining number of susceptible contacts.</p>
<p>The SIR model incorporates this pattern by including a transmission rate (<span class="math inline">\(\beta\)</span>) that determines how quickly susceptible individuals become infected when they come into contact with infected individuals. The model also includes a recovery rate (<span class="math inline">\(\gamma\)</span>), which dictates how quickly infected individuals recover and move to the recovered class. By adjusting these parameters, the model can reproduce the observed pattern of an infection peak. If the model fails to produce this peak under realistic parameter settings, it might indicate a need for revising the model structure, such as adding more complexity like considering varying transmission rates over time (e.g., due to public health interventions).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="what-is-pattern-oriented-modelling-2" class="slide level2">
<h2>What is <span class="kn-pink">pattern-oriented modelling</span>?</h2>
<p><span class="nord-light">Patterns for Theory Development <span class="citation" data-cites="railsback2019agent">(<a href="#/section-16" role="doc-biblioref" onclick="">Railsback and Grimm 2019</a>)</span></span></p>
<div class="columns">
<div class="column" style="width:45%;">
<p>We use ABMs to <strong>formulate</strong>, <strong>test</strong>, and <strong>refine</strong> mechanistic theories of <strong>how the observed patterns were generated</strong>.</p>
<p><br></p>
<p>In the <strong>SIR model example</strong>, patterns like the peak of infections or the eventual stabilization of the population into susceptible and recovered groups are used to test and refine theories of disease spread.</p>
<p><br></p>
<p>Theories about how individuals become infected and recover are tested by checking whether the model can replicate these observed patterns. If the model consistently reproduces the patterns, it supports the validity of the theory. If not, it needs to be adjusted – perhaps by considering factors like varying contact rates or the impact of interventions. The process repeats until the model behaves as expected.</p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/sir_compare.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system."><img data-src="media/sir_compare.png" class="shadow-img" style="width:100.0%" alt="Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system."></a></p>
<figcaption>Like generative network analysis, the high-level objective is to deepen our understanding of the latent processes governing the system.</figcaption>
</figure>
</div>
</div></div>
</section></section>
<section>
<section id="mesa" class="title-slide slide level1 center" data-background-image="media/robot.jpg">
<h1>Mesa</h1>
<p>Developing Your First ABM</p>
</section>
<section id="an-med-of-oop-for-abm-sorry" class="slide level2">
<h2>An MED of OOP for ABM <span class="nord-light">(sorry…)</span></h2>
<p><span class="nord-footer">Object-oriented Programming (OOP), Essential Concepts</span></p>
<p><br></p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/oliver-roos-PCNdauVPbjA-unsplash.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Photo by Oliver Roos on Unsplash"><img data-src="media/oliver-roos-PCNdauVPbjA-unsplash.jpg" style="width:100.0%" alt="Photo by Oliver Roos on Unsplash"></a></p>
<figcaption><span class="nord-light">Photo by <a href="https://unsplash.com/@fairfilter?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Oliver Roos</a> on <a href="https://unsplash.com/photos/landscape-photography-of-splitted-road-surrounded-with-trees-PCNdauVPbjA?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></span></figcaption>
</figure>
</div>
</div><div class="column" style="width:65%;">
<ul>
<li><strong>Classes</strong> are like blueprints for creating objects (e.g., a Person class defines what properties and behaviors a person has).</li>
<li><strong>Objects</strong> are specific instances of a class (e.g., <code>maria = Person()</code> creates an object <code>maria</code> from the <code>Person</code> class).</li>
<li><strong>Attributes</strong> are variables that store data specific to an object (e.g., alice.age).</li>
<li><strong>Methods</strong> are functions that define behaviors of an object (e.g., <code>alice.move()</code>).</li>
<li><strong>Inheritance</strong> allows one class to inherit attributes and methods from another class, promoting code reuse (e.g., Professor class inherits from Person, because professors are people too).</li>
<li><strong>Encapsulation</strong> allows us to bundle data (attributes) and methods that operate on the data into a single unit or class, restricting direct access to some of an object’s components.</li>
</ul>
</div></div>
<aside class="notes">
<p>Introduction to OOP:</p>
<ul>
<li>Object-Oriented Programming (OOP) is a programming paradigm that structures software design around data, or objects, rather than functions and logic. It’s especially useful for modeling complex systems, like those you’ll encounter in agent-based modeling (ABM).</li>
</ul>
<p>Classes and Objects:</p>
<ul>
<li>Think of a class as a blueprint. For example, if you’re modeling a group of people, the class might be Person. This class defines the properties (e.g., age, location) and behaviors (e.g., move, speak) that every person should have.</li>
<li>An object is a specific instance of that class. If you were to create a person named Alice in your model, you would instantiate the Person class like this: alice = Person(). Now, alice is an object with her own specific age, location, and so on.</li>
</ul>
<p>Attributes and Methods:</p>
<ul>
<li>Attributes are like variables that hold information about the object. For example, alice.age = 25 sets Alice’s age to 25. Each object can have different values for these attributes.</li>
<li>Methods are functions that belong to the class and define what an object can do. For example, alice.move() could be a method that changes Alice’s location within the simulation.</li>
</ul>
<p>Inheritance:</p>
<ul>
<li>Inheritance allows you to create a new class that is based on an existing class. If you have a Worker class that should include everything a Person has, but with some additional features, you can create Worker as a subclass of Person. This means Worker inherits all attributes and methods from Person but can also have its own unique features. This is crucial in ABM, where you might have different types of agents with shared behaviors.</li>
</ul>
<p>Encapsulation:</p>
<ul>
<li>Encapsulation is the idea of keeping the internal workings of an object hidden from the outside. You can think of it as protecting the data inside an object. For example, you might not want other parts of your program to change an agent’s age directly; instead, they might call a method that safely updates the age. Encapsulation helps maintain the integrity of your model’s data and logic.</li>
</ul>
<p>Applying OOP in Mesa:</p>
<ul>
<li>When you move to Mesa, you’ll use these OOP principles to define your agents as classes. Each agent will be an object of its class, with attributes that define its state (like position or health) and methods that define its behavior (like move() or interact()).</li>
<li>You’ll also use inheritance to create different types of agents with shared and unique behaviors, which makes your model more scalable and easier to manage.</li>
</ul>
<p>In short, OOP is fundamental for structuring your agent-based models in Python. By organizing your code into classes and objects, you can create agents with complex behaviors and interactions that are both manageable and scalable, which is exactly what you’ll be doing in Mesa.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="agent-based-modelling-with-mesa" class="slide level2">
<h2>Agent-based Modelling with Mesa</h2>
<p><span class="nord-footer">Object-oriented Programming (OOP), Essential Concepts</span></p>
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<ul>
<li>We define an <span class="kn-pink">Agent Class</span> <span class="nord-light">(which inherits from a more general Mesa class)</span>. Each agent created from our class is an <strong>object</strong> with <strong>attributes</strong> <span class="nord-light">(states)</span> and <strong>methods</strong> <span class="nord-light">(behaviors)</span>.</li>
<li>The <strong>environment</strong> is typically represented as a grid or network where agents interact. The <span class="kn-pink">Model class</span> manages the overall simulation, including initializing agents, updating them each step, and collecting data.</li>
<li>The Mesa <span class="kn-pink">Scheduler</span> determines the order in which agents act. Common options include random or sequential activation. Agents execute their actions and update their states in each step of the schedule <span class="nord-light">(i.e., a tick of time)</span>.</li>
<li>The Mesa <span class="kn-pink">DataCollector</span> is used to gather and store data during the simulation for analysis.</li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p><a href="media/robot.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img data-src="media/robot.jpg" class="shadow-img" style="width:100.0%"></a></p>
<p><span class="nord-footer">Agents are like little robots we manufacture according to some set of explicit instructions (the agent class).</span></p>
</div></div>
<aside class="notes">
<p>When we build agent-based models with Mesa, we apply these OOP concepts. Each agent in our models are instances of a class, meaning it has specific attributes and methods that define how it behaves in the simulation. In our SIR model, for example, each agent has a state attribute that indicates whether the agent is currently susceptible, infected, or in recovery.</p>
<p>The environment where our agents interact is managed by the Model class. This environment could be a grid (like a city map) or a network (like social connections). The Model class handles the setup, including creating agents and placing them in the environment, and it oversees the simulation process.</p>
<p>The Scheduler in Mesa is key to controlling how and when agents act. You can set agents to act in a random order, which might simulate more realistic scenarios, or in a specific sequence, depending on what makes sense for your model. This scheduling allows the simulation to evolve dynamically as agents interact with each other and the environment. Throughout the simulation, you can use the DataCollector to track various metrics—like the number of infected individuals in our SIR model. This data is crucial for analyzing the outcomes of your model.</p>
<p>With that, let’s get into things!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p><br><br></p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/chatgpt_dependency_hell.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="ChatGPT / DALL-E3’s artistic rendering of “dependency hell.”"><img data-src="media/chatgpt_dependency_hell.png" class="shadow-img" style="width:100.0%" alt="ChatGPT / DALL-E3’s artistic rendering of “dependency hell.”"></a></p>
<figcaption>ChatGPT / DALL-E3’s artistic rendering of “dependency hell.”</figcaption>
</figure>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:60%;">
<p>First, we set up our environment. We’ll continue using the <code>gt</code> environment from yesterday. If you created it from the <code>setup/graphtool.yml</code> file, it has everything we need.</p>
<p><br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource zsh number-lines code-with-copy"><code class="sourceCode zsh"><span id="cb1-1"><a href=""></a><span class="bu">cd</span> computational-social-science</span>
<span id="cb1-2"><a href=""></a><span class="ex">conda</span> env create <span class="at">-f</span> setup/graphtool.yaml</span>
<span id="cb1-3"><a href=""></a><span class="ex">conda</span> activate gt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Let’s develop the</p>
<h3 id="sir-model">SIR model</h3>
<p>we’ve been using as an example so far.</p>
<p><br></p>
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/lady-gaga-carpool-karoake.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Important! Some of the code that follows is more complex than anything we’ve done in the course so far. By way of analogy, I’m popping the hood of an old car to show you what key components of the machine look like and how they work together. However, the main goal is for you to learn how to drive these machines safely, so focus on understanding the logic of the modelling cycle and feel free to temporarily set aside any details that get in the way of that goal."><img data-src="media/lady-gaga-carpool-karoake.jpg" class="shadow-img" style="width:100.0%" alt="Important! Some of the code that follows is more complex than anything we’ve done in the course so far. By way of analogy, I’m popping the hood of an old car to show you what key components of the machine look like and how they work together. However, the main goal is for you to learn how to drive these machines safely, so focus on understanding the logic of the modelling cycle and feel free to temporarily set aside any details that get in the way of that goal."></a></p>
<figcaption><span class="kn-pink">Important!</span> Some of the code that follows is more complex than anything we’ve done in the course so far. By way of analogy, I’m popping the hood of an old car to show you what key components of the machine look like and how they work together. However, <strong>the main goal is for you to learn how to drive these machines safely</strong>, so focus on understanding the logic of the modelling cycle and feel free to temporarily set aside any details that get in the way of that goal.</figcaption>
</figure>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:55%;">
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href=""></a><span class="im">import</span> mesa</span>
<span id="cb2-2"><a href=""></a><span class="im">from</span> mesa <span class="im">import</span> Agent, Model</span>
<span id="cb2-3"><a href=""></a><span class="im">from</span> mesa.time <span class="im">import</span> RandomActivation</span>
<span id="cb2-4"><a href=""></a><span class="im">from</span> mesa.space <span class="im">import</span> MultiGrid</span>
<span id="cb2-5"><a href=""></a><span class="im">from</span> mesa.datacollection <span class="im">import</span> DataCollector</span>
<span id="cb2-6"><a href=""></a><span class="im">from</span> mesa.batchrunner <span class="im">import</span> batch_run</span>
<span id="cb2-7"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href=""></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb2-9"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-10"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-11"><a href=""></a><span class="im">import</span> random</span>
<span id="cb2-12"><a href=""></a><span class="im">import</span> yaml</span>
<span id="cb2-13"><a href=""></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb2-14"><a href=""></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-15"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-16"><a href=""></a><span class="im">import</span> icsspy</span>
<span id="cb2-17"><a href=""></a><span class="im">from</span> icsspy.networks <span class="im">import</span> plot_line_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Set a seed, for reproducibility, and <span class="nord-light">(optionally)</span> use <code>icsspy.set_style()</code> to style your plots like mine.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href=""></a>random.seed(<span class="dv">30</span>)</span>
<span id="cb3-2"><a href=""></a>icsspy.set_style()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="first-define-the-agent-class" class="slide level2">
<h2>First, define the <span class="kn-pink">agent class</span></h2>
<p><br></p>
<p>Remember that the agent class is like a blueprint for creating agents. Here, each agent can be in one of three states: susceptible, infected, or recovered. The agent interacts with its environment by moving, tracking its position, and interacting with other agents. The agent can get infected, spread the infection to others, and eventually recover based on a random chance within a specified recovery time range.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href=""></a><span class="kw">class</span> SIRAgent(Agent):</span>
<span id="cb4-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb4-3"><a href=""></a>        <span class="va">self</span>,</span>
<span id="cb4-4"><a href=""></a>        unique_id,</span>
<span id="cb4-5"><a href=""></a>        model,</span>
<span id="cb4-6"><a href=""></a>        recovery_time_range<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">12</span>),</span>
<span id="cb4-7"><a href=""></a>        max_agent_step_size<span class="op">=</span><span class="dv">1</span></span>
<span id="cb4-8"><a href=""></a>    ):</span>
<span id="cb4-9"><a href=""></a></span>
<span id="cb4-10"><a href=""></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(unique_id, model)</span>
<span id="cb4-11"><a href=""></a>        <span class="va">self</span>.state <span class="op">=</span> <span class="st">"S"</span></span>
<span id="cb4-12"><a href=""></a>        <span class="va">self</span>.infected_time <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-13"><a href=""></a>        <span class="va">self</span>.recovery_time_range <span class="op">=</span> recovery_time_range</span>
<span id="cb4-14"><a href=""></a>        <span class="va">self</span>.max_agent_step_size <span class="op">=</span> max_agent_step_size</span>
<span id="cb4-15"><a href=""></a>        <span class="va">self</span>.pos_history <span class="op">=</span> []</span>
<span id="cb4-16"><a href=""></a>        <span class="va">self</span>.interactions <span class="op">=</span> {}</span>
<span id="cb4-17"><a href=""></a></span>
<span id="cb4-18"><a href=""></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb4-19"><a href=""></a>        <span class="cf">if</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">"I"</span>:</span>
<span id="cb4-20"><a href=""></a>            <span class="va">self</span>.infected_time <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-21"><a href=""></a>            <span class="co"># check if agent is within the recovery window</span></span>
<span id="cb4-22"><a href=""></a>            <span class="cf">if</span> <span class="va">self</span>.infected_time <span class="op">&gt;=</span> <span class="va">self</span>.recovery_time_range[<span class="dv">0</span>]:</span>
<span id="cb4-23"><a href=""></a>                <span class="co"># if so, recover probabilistically</span></span>
<span id="cb4-24"><a href=""></a>                <span class="cf">if</span> <span class="va">self</span>.random.random() <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="kw">or</span> <span class="va">self</span>.infected_time <span class="op">&gt;=</span> <span class="va">self</span>.recovery_time_range[<span class="dv">1</span>]:</span>
<span id="cb4-25"><a href=""></a>                    <span class="va">self</span>.state <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb4-26"><a href=""></a></span>
<span id="cb4-27"><a href=""></a>            <span class="co"># if still infected, try to infect others</span></span>
<span id="cb4-28"><a href=""></a>            <span class="cf">if</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">"I"</span>:</span>
<span id="cb4-29"><a href=""></a>                neighbors <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighbors(<span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-30"><a href=""></a>                <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb4-31"><a href=""></a>                    <span class="cf">if</span> neighbor.state <span class="op">==</span> <span class="st">"S"</span> <span class="kw">and</span> <span class="va">self</span>.random.random() <span class="op">&lt;</span> <span class="va">self</span>.model.infection_rate:</span>
<span id="cb4-32"><a href=""></a>                        neighbor.state <span class="op">=</span> <span class="st">"I"</span></span>
<span id="cb4-33"><a href=""></a></span>
<span id="cb4-34"><a href=""></a>        <span class="co"># move to a random neighboring cell with the given step size; record the new position</span></span>
<span id="cb4-35"><a href=""></a>        possible_moves <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighborhood(</span>
<span id="cb4-36"><a href=""></a>            <span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span>, radius<span class="op">=</span><span class="va">self</span>.max_agent_step_size</span>
<span id="cb4-37"><a href=""></a>        )</span>
<span id="cb4-38"><a href=""></a></span>
<span id="cb4-39"><a href=""></a>        new_position <span class="op">=</span> <span class="va">self</span>.random.choice(possible_moves)</span>
<span id="cb4-40"><a href=""></a>        <span class="va">self</span>.model.grid.move_agent(<span class="va">self</span>, new_position)</span>
<span id="cb4-41"><a href=""></a>        <span class="va">self</span>.pos_history.append(new_position)</span>
<span id="cb4-42"><a href=""></a></span>
<span id="cb4-43"><a href=""></a>        <span class="co"># record interactions with other agents in this step</span></span>
<span id="cb4-44"><a href=""></a>        neighbors <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighbors(</span>
<span id="cb4-45"><a href=""></a>            <span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span></span>
<span id="cb4-46"><a href=""></a>        )</span>
<span id="cb4-47"><a href=""></a></span>
<span id="cb4-48"><a href=""></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb4-49"><a href=""></a>            <span class="cf">if</span> neighbor.unique_id <span class="kw">in</span> <span class="va">self</span>.interactions:</span>
<span id="cb4-50"><a href=""></a>                <span class="va">self</span>.interactions[neighbor.unique_id] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-51"><a href=""></a>            <span class="cf">else</span>:</span>
<span id="cb4-52"><a href=""></a>                <span class="va">self</span>.interactions[neighbor.unique_id] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>I’m not going to explain every line of this code, since that’s not the point of popping the hood and showing it to you, but I do want to highlight a few key pieces.</p>
<ul>
<li>Line 1 defines a new class called SIRAgent. The Agent in parentheses means that SIRAgent is a subclass of Agent, meaning it inherits properties and behaviors from the Agent class provided by Mesa.</li>
<li>Lines 2-8 is the constructor method that gets called when a new SIRAgent object is created. It initializes the agent with specific attributes. It has parameters for:
<ul>
<li>unique_id: A unique identifier for the agent.</li>
<li>model: The model (environment) in which the agent exists.</li>
<li>recovery_time_range: A tuple representing the minimum and maximum time (in steps) it takes for the agent to recover after being infected.</li>
<li>max_agent_step_size: The maximum distance the agent can move in one step.</li>
</ul></li>
<li>Line 10 calls the constructor of the parent Agent class to give the agent a unique ID within the model.</li>
<li>Lines 11 to 16 set the initial attributes of the agent. Lines 15 and 16 collect information about each agent’s local and neighboring agents at each step. This will come up a bit later.</li>
<li>Starting on Line 18, we define the agent’s step function, which determines what how the agent’s states are updated and the actions they take when it’s their turn to act in the model. In this case, we first check our agent’s state. If they are infected, we increment the days infected counter and check whether they are in the recovery window. If so, we flip a coin to see if they recover. If the agent is still infected, they try to infect their neighbors. We iterate over the neighbors and, if the infection conditions are met (random), then we switch the neighbors status to infected. Then the agent moves to a new location on the grid that is within a pre-defined number of steps. The interactions and movement is logged.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="second-define-the-model-class" class="slide level2">
<h2>Second, define the <span class="kn-pink">model class</span></h2>
<p><br></p>
<p>Remember that the SIRModel is a blueprint for creating a model in which agents interact and spread infections. Any ABMs we create are created by this class. It inherits from Mesa’s more general Model class, which provides basic functionality for simulation modelling that we don’t need to design or develop ourselves.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href=""></a><span class="kw">class</span> SIRModel(Model):</span>
<span id="cb5-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb5-3"><a href=""></a>        <span class="va">self</span>,</span>
<span id="cb5-4"><a href=""></a>        grid_width,</span>
<span id="cb5-5"><a href=""></a>        grid_height,</span>
<span id="cb5-6"><a href=""></a>        N,</span>
<span id="cb5-7"><a href=""></a>        infection_rate,</span>
<span id="cb5-8"><a href=""></a>        recovery_time_range,</span>
<span id="cb5-9"><a href=""></a>        max_agent_step_size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-10"><a href=""></a>        n_initial_infections<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-11"><a href=""></a>        max_iterations<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb5-12"><a href=""></a>        change_threshold<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb5-13"><a href=""></a>    ):</span>
<span id="cb5-14"><a href=""></a></span>
<span id="cb5-15"><a href=""></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb5-16"><a href=""></a>        <span class="va">self</span>.num_agents <span class="op">=</span> N</span>
<span id="cb5-17"><a href=""></a>        <span class="va">self</span>.grid <span class="op">=</span> MultiGrid(grid_width, grid_height, <span class="va">True</span>)</span>
<span id="cb5-18"><a href=""></a>        <span class="va">self</span>.schedule <span class="op">=</span> RandomActivation(<span class="va">self</span>)</span>
<span id="cb5-19"><a href=""></a>        <span class="va">self</span>.infection_rate <span class="op">=</span> infection_rate</span>
<span id="cb5-20"><a href=""></a>        <span class="va">self</span>.recovery_time_range <span class="op">=</span> recovery_time_range</span>
<span id="cb5-21"><a href=""></a>        <span class="va">self</span>.max_agent_step_size <span class="op">=</span> max_agent_step_size</span>
<span id="cb5-22"><a href=""></a>        <span class="va">self</span>.max_iterations <span class="op">=</span> max_iterations</span>
<span id="cb5-23"><a href=""></a>        <span class="va">self</span>.current_iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-24"><a href=""></a>        <span class="va">self</span>.change_threshold <span class="op">=</span> change_threshold</span>
<span id="cb5-25"><a href=""></a>        <span class="co"># track the ratio of infected agents in the previous step</span></span>
<span id="cb5-26"><a href=""></a>        <span class="va">self</span>.previous_infected_ratio <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-27"><a href=""></a></span>
<span id="cb5-28"><a href=""></a>        <span class="co"># create agents</span></span>
<span id="cb5-29"><a href=""></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.num_agents):</span>
<span id="cb5-30"><a href=""></a>            <span class="co"># half the agents will have a large step size, half small</span></span>
<span id="cb5-31"><a href=""></a>            step_size <span class="op">=</span> max_agent_step_size <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb5-32"><a href=""></a>            a <span class="op">=</span> SIRAgent(i, <span class="va">self</span>, recovery_time_range, max_agent_step_size<span class="op">=</span>step_size)</span>
<span id="cb5-33"><a href=""></a>            <span class="va">self</span>.grid.place_agent(a, (<span class="va">self</span>.random.randrange(<span class="va">self</span>.grid.width),</span>
<span id="cb5-34"><a href=""></a>                                      <span class="va">self</span>.random.randrange(<span class="va">self</span>.grid.height)))</span>
<span id="cb5-35"><a href=""></a>            <span class="co"># initialize the position history with the starting position</span></span>
<span id="cb5-36"><a href=""></a>            a.pos_history.append(a.pos)</span>
<span id="cb5-37"><a href=""></a>            <span class="va">self</span>.schedule.add(a)</span>
<span id="cb5-38"><a href=""></a></span>
<span id="cb5-39"><a href=""></a>        <span class="co"># randomly infect a specified number of agents</span></span>
<span id="cb5-40"><a href=""></a>        initial_infected_agents <span class="op">=</span> <span class="va">self</span>.random.sample(</span>
<span id="cb5-41"><a href=""></a>            <span class="va">self</span>.schedule.agents, n_initial_infections</span>
<span id="cb5-42"><a href=""></a>        )</span>
<span id="cb5-43"><a href=""></a>        <span class="cf">for</span> agent <span class="kw">in</span> initial_infected_agents:</span>
<span id="cb5-44"><a href=""></a>            agent.state <span class="op">=</span> <span class="st">"I"</span></span>
<span id="cb5-45"><a href=""></a>            agent.infected_time <span class="op">=</span> <span class="dv">0</span> <span class="co"># initialize infection duration</span></span>
<span id="cb5-46"><a href=""></a></span>
<span id="cb5-47"><a href=""></a>        <span class="va">self</span>.datacollector <span class="op">=</span> DataCollector(</span>
<span id="cb5-48"><a href=""></a>            model_reporters<span class="op">=</span>{</span>
<span id="cb5-49"><a href=""></a>                <span class="st">"Susceptible"</span>: <span class="kw">lambda</span> m: <span class="va">self</span>.count_state(<span class="st">"S"</span>),</span>
<span id="cb5-50"><a href=""></a>                <span class="st">"Infected"</span>: <span class="kw">lambda</span> m: <span class="va">self</span>.count_state(<span class="st">"I"</span>),</span>
<span id="cb5-51"><a href=""></a>                <span class="st">"Recovered"</span>: <span class="kw">lambda</span> m: <span class="va">self</span>.count_state(<span class="st">"R"</span>)</span>
<span id="cb5-52"><a href=""></a>            },</span>
<span id="cb5-53"><a href=""></a>            agent_reporters<span class="op">=</span>{</span>
<span id="cb5-54"><a href=""></a>                <span class="st">"State"</span>: <span class="st">"state"</span>,</span>
<span id="cb5-55"><a href=""></a>                <span class="st">"Infection_Duration"</span>: <span class="st">"infection_duration"</span></span>
<span id="cb5-56"><a href=""></a>            }</span>
<span id="cb5-57"><a href=""></a>        )</span>
<span id="cb5-58"><a href=""></a>        <span class="co"># this line is necessary for doing multiple model runs simultaneously</span></span>
<span id="cb5-59"><a href=""></a>        <span class="co"># we will do this later in the lecture</span></span>
<span id="cb5-60"><a href=""></a>        <span class="va">self</span>.running <span class="op">=</span> <span class="va">True</span></span>
<span id="cb5-61"><a href=""></a></span>
<span id="cb5-62"><a href=""></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb5-63"><a href=""></a>        <span class="va">self</span>.datacollector.collect(<span class="va">self</span>)</span>
<span id="cb5-64"><a href=""></a>        <span class="va">self</span>.schedule.step()</span>
<span id="cb5-65"><a href=""></a>        <span class="va">self</span>.current_iteration <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-66"><a href=""></a></span>
<span id="cb5-67"><a href=""></a>        <span class="co"># check for stopping condition based on maximum iterations</span></span>
<span id="cb5-68"><a href=""></a>        <span class="cf">if</span> <span class="va">self</span>.current_iteration <span class="op">&gt;=</span> <span class="va">self</span>.max_iterations:</span>
<span id="cb5-69"><a href=""></a>            <span class="va">self</span>.running <span class="op">=</span> <span class="va">False</span></span>
<span id="cb5-70"><a href=""></a></span>
<span id="cb5-71"><a href=""></a>        <span class="co"># check for stopping condition based on change in infected ratio</span></span>
<span id="cb5-72"><a href=""></a>        current_infected_ratio <span class="op">=</span> <span class="va">self</span>.count_state(<span class="st">'I'</span>)</span>
<span id="cb5-73"><a href=""></a>        <span class="cf">if</span> <span class="va">self</span>.previous_infected_ratio <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb5-74"><a href=""></a>            change <span class="op">=</span> <span class="bu">abs</span>(current_infected_ratio <span class="op">-</span> <span class="va">self</span>.previous_infected_ratio)</span>
<span id="cb5-75"><a href=""></a>            <span class="cf">if</span> change <span class="op">&lt;</span> <span class="va">self</span>.change_threshold:</span>
<span id="cb5-76"><a href=""></a>                <span class="va">self</span>.running <span class="op">=</span> <span class="va">False</span></span>
<span id="cb5-77"><a href=""></a>        <span class="va">self</span>.previous_infected_ratio <span class="op">=</span> current_infected_ratio</span>
<span id="cb5-78"><a href=""></a></span>
<span id="cb5-79"><a href=""></a>    <span class="kw">def</span> count_state(<span class="va">self</span>, state_name):</span>
<span id="cb5-80"><a href=""></a>        count <span class="op">=</span> <span class="bu">sum</span>([<span class="dv">1</span> <span class="cf">for</span> a <span class="kw">in</span> <span class="va">self</span>.schedule.agents <span class="cf">if</span> a.state <span class="op">==</span> state_name])</span>
<span id="cb5-81"><a href=""></a>        <span class="cf">return</span> count <span class="op">/</span> <span class="va">self</span>.num_agents</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li>Lines 1-13 define a new class called SIRModel. It inherits from the Model class in Mesa, so it starts with some basic functionality for running simulations.</li>
<li>Line 15 is the constructor method that initializes the model with specific settings when you create a new instance of SIRModel. It calls the constructor of the parent Model class to make sure the SIRModel is set up correctly with inherited attributes.</li>
<li>Lines 16-26 are for the model parameters, which we set when we initialize a new model.</li>
<li>Lines 28-37 create the agents using the AgentClass, adds them to the model grid (space) and schedule (time)</li>
<li>Lines 39-45 randomly infect an initial set of agents</li>
<li>Lines 47-57 set up automated data collection throughout the simulation</li>
<li>Line 60 is necessary for running multiple simulations at once, which we will see a little later in the lecture.</li>
<li>Lines 62-77 defines what happens for each time of time we step through in the model, including running the agent steps, collecting data on what happened, and checking the stopping conditions to see whether the model should continue running.</li>
<li>The remaining code defines some methods that are used to compute the number or infected nodes</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="third-load-the-model-parameters" class="slide level2">
<h2>Third, load the <span class="kn-pink">model parameters</span></h2>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'_variables.yml'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb6-2"><a href=""></a>    params <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb6-3"><a href=""></a></span>
<span id="cb6-4"><a href=""></a>model_1_params <span class="op">=</span> params.get(<span class="st">'model_1'</span>)</span>
<span id="cb6-5"><a href=""></a>pprint(model_1_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="monospace">{‘N’: 100, ‘grid_height’: 40, ‘grid_width’: 40, ‘infection_rate’: 0.3, ‘max_agent_step_size’: 1, ‘n_initial_infections’: 2, ‘n_iterations’: 150, ‘recovery_time_range’: [14, 24]}</span></p>
<p><br></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a>model_2_params <span class="op">=</span> params.get(<span class="st">'model_2'</span>)</span>
<span id="cb7-2"><a href=""></a>pprint(model_2_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="monospace">{‘N’: 100, ‘grid_height’: 40, ‘grid_width’: 40, ‘infection_rate’: 0.15, ‘max_agent_step_size’: 1, ‘n_initial_infections’: 2, ‘n_iterations’: 150, ‘recovery_time_range’: [14, 24]}</span></p>
</section>
<section id="forth-run-the-models" class="slide level2">
<h2>Forth, <span class="kn-pink">run the model(s)</span></h2>
<div class="columns">
<div class="column" style="width:65%;">
<p>We’ll run two models here to reproduce <a href="#/mixing-and-flattening-the-curve" class="quarto-xref">Figure&nbsp;1</a>. Here’s <strong>Model 1</strong>!</p>
<p><br></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a>model_1 <span class="op">=</span> SIRModel(</span>
<span id="cb8-2"><a href=""></a>    n_initial_infections <span class="op">=</span> model_1_params[<span class="st">'n_initial_infections'</span>],</span>
<span id="cb8-3"><a href=""></a>    grid_width <span class="op">=</span> model_1_params[<span class="st">'grid_width'</span>],</span>
<span id="cb8-4"><a href=""></a>    grid_height <span class="op">=</span> model_1_params[<span class="st">'grid_height'</span>],</span>
<span id="cb8-5"><a href=""></a>    N <span class="op">=</span> model_1_params[<span class="st">'N'</span>],</span>
<span id="cb8-6"><a href=""></a>    infection_rate <span class="op">=</span> model_1_params[<span class="st">'infection_rate'</span>],</span>
<span id="cb8-7"><a href=""></a>    recovery_time_range <span class="op">=</span> model_1_params[<span class="st">'recovery_time_range'</span>],</span>
<span id="cb8-8"><a href=""></a>    max_agent_step_size <span class="op">=</span> model_1_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb8-9"><a href=""></a>)</span>
<span id="cb8-10"><a href=""></a></span>
<span id="cb8-11"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_1_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb8-12"><a href=""></a>    model_1.step()</span>
<span id="cb8-13"><a href=""></a></span>
<span id="cb8-14"><a href=""></a>m1res <span class="op">=</span> model_1.datacollector.get_model_vars_dataframe()</span>
<span id="cb8-15"><a href=""></a>m1res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:30%;">
<!--
```python
#| echo: false
from icsspy.utils import markdown_table
md = markdown_table(m1res.sample(10), 'tables/_sir_1_m1res.md')
print(md)
```
 -->
<p>Random sample (N=10)</p>
<p><br></p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Susceptible</th>
<th style="text-align: right;">Infected</th>
<th style="text-align: right;">Recovered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.24</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="forth-run-the-models-1" class="slide level2">
<h2>Forth, <span class="kn-pink">run the model(s)</span></h2>
<div class="columns">
<div class="column" style="width:65%;">
<p>And here’s <strong>Model 2</strong>!</p>
<p><br></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a>model_2 <span class="op">=</span> SIRModel(</span>
<span id="cb9-2"><a href=""></a>    n_initial_infections <span class="op">=</span> model_2_params[<span class="st">'n_initial_infections'</span>],</span>
<span id="cb9-3"><a href=""></a>    grid_width <span class="op">=</span> model_2_params[<span class="st">'grid_width'</span>],</span>
<span id="cb9-4"><a href=""></a>    grid_height <span class="op">=</span> model_2_params[<span class="st">'grid_height'</span>],</span>
<span id="cb9-5"><a href=""></a>    N <span class="op">=</span> model_2_params[<span class="st">'N'</span>],</span>
<span id="cb9-6"><a href=""></a>    infection_rate <span class="op">=</span> model_2_params[<span class="st">'infection_rate'</span>],</span>
<span id="cb9-7"><a href=""></a>    recovery_time_range <span class="op">=</span> model_2_params[<span class="st">'recovery_time_range'</span>],</span>
<span id="cb9-8"><a href=""></a>    max_agent_step_size <span class="op">=</span> model_2_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb9-9"><a href=""></a>)</span>
<span id="cb9-10"><a href=""></a></span>
<span id="cb9-11"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_2_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb9-12"><a href=""></a>    model_2.step()</span>
<span id="cb9-13"><a href=""></a></span>
<span id="cb9-14"><a href=""></a>m2res <span class="op">=</span> model_2.datacollector.get_model_vars_dataframe()</span>
<span id="cb9-15"><a href=""></a>m2res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:30%;">
<!--
```python
#| echo: false
md = markdown_table(m2res.sample(10), 'tables/_sir_1_m2res.md')
print(md)
```
 -->
<p>Random sample (N=10)</p>
<p><br></p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Susceptible</th>
<th style="text-align: right;">Infected</th>
<th style="text-align: right;">Recovered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="plot-the-results" class="slide level2">
<h2>Plot the results</h2>
<p><br></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb10-2"><a href=""></a>ax.plot(m1res[<span class="st">'Infected'</span>], label<span class="op">=</span><span class="vs">r'High transmissibility, $\beta$=0.3'</span>)</span>
<span id="cb10-3"><a href=""></a>ax.plot(m2res[<span class="st">'Infected'</span>], label<span class="op">=</span><span class="vs">r'Low transmissibility $\beta$=0.15'</span>)</span>
<span id="cb10-4"><a href=""></a>plt.xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Discrete Steps in Time"</span>)</span>
<span id="cb10-5"><a href=""></a>plt.ylabel(<span class="st">"Proportion Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb10-6"><a href=""></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb10-7"><a href=""></a>plt.savefig(<span class="st">'media/sir_compare_models_1-2.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<p><a href="media/sir_compare_models_1-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img data-src="media/sir_compare_models_1-2.png" class="shadow-img" style="width:100.0%"></a></p>
<!-- ![](media/sir_compare){width=100% .shadow-img} -->
<p>Recall <span class="kn-pink">design patterns</span>!</p>
</div><div class="column" style="width:75%;">
<p><br></p>
<p><span class="math inline">\(\longleftarrow\)</span><br><a href="#/mixing-and-flattening-the-curve" class="quarto-xref">Figure&nbsp;1</a> from earlier in the lecture. Proportion of infected people in a population over time from two SIR simulations with different transmissibility rates.<br></p>
<p>Not (yet) shown: proportion of susceptible and recovered.</p>
</div></div>
<!-- (TEMPORARILY?) CUTTING THIS OUT; NO SPACE AND NOT PEDAGOGICALLY USEFUL ANYWAY -->
<!-- _day-5-CUT-illustrative-models.qmd -->
<!--
```python
#| echo: false
from icsspy.utils import update_quarto_variables

# compute the infection peak for both models so you can use them dynamically in the lecture
update_quarto_variables("results_sir_model_1_max_infected", float(m1res['Infected'].max()))
update_quarto_variables("results_sir_model_2_max_infected", float(m2res['Infected'].max()))
```
 -->
</section>
<section id="agent-interaction" class="slide level2">
<h2>Agent Interaction</h2>
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/anthony-delanoix-hzgs56Ze49s-unsplash.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Who interacted with whom?"><img data-src="media/anthony-delanoix-hzgs56Ze49s-unsplash.jpg" class="shadow-img" style="width:65.0%" alt="Who interacted with whom?"></a></p>
<figcaption>Who interacted with whom?</figcaption>
</figure>
</div>
</section>
<section id="agent-interaction-1" class="slide level2">
<h2>Agent Interaction</h2>
<p>We can iterate over the agents in the model and retrieve their interaction history. <span class="nord-light">Note that we can only do this because I built that data collection into the model! We can collect just about anything we want, but only if we set things up properly.</span> Let’s construct some agent <strong>interaction networks</strong>!</p>
<p><br></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href=""></a>interaction_graphs <span class="op">=</span> {}</span>
<span id="cb11-2"><a href=""></a>interaction_graph_summaries <span class="op">=</span> {}</span>
<span id="cb11-3"><a href=""></a></span>
<span id="cb11-4"><a href=""></a>models <span class="op">=</span> [model_1, model_2]</span>
<span id="cb11-5"><a href=""></a><span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models, start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb11-6"><a href=""></a>    wel <span class="op">=</span> []</span>
<span id="cb11-7"><a href=""></a>    <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents:</span>
<span id="cb11-8"><a href=""></a>        <span class="cf">for</span> k, v <span class="kw">in</span> agent.interactions.items():</span>
<span id="cb11-9"><a href=""></a>            wel.append((<span class="bu">int</span>(agent.unique_id), k, v))</span>
<span id="cb11-10"><a href=""></a></span>
<span id="cb11-11"><a href=""></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb11-12"><a href=""></a>    G.add_weighted_edges_from(wel)</span>
<span id="cb11-13"><a href=""></a>    interaction_graphs[<span class="ss">f'M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> G</span>
<span id="cb11-14"><a href=""></a></span>
<span id="cb11-15"><a href=""></a>    avg_degree <span class="op">=</span> <span class="bu">round</span>(<span class="bu">sum</span>(<span class="bu">dict</span>(G.degree()).values()) <span class="op">/</span> <span class="bu">float</span>(G.number_of_nodes()), <span class="dv">2</span>)</span>
<span id="cb11-16"><a href=""></a>    interaction_graph_summaries[<span class="ss">f'M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (G.number_of_nodes(), G.number_of_edges(), avg_degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agent-interaction-2" class="slide level2">
<h2>Agent Interaction</h2>
<p><br></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href=""></a>interaction_graph_summaries <span class="op">=</span> pd.DataFrame(interaction_graph_summaries).T</span>
<span id="cb12-2"><a href=""></a>interaction_graph_summaries.columns <span class="op">=</span> [<span class="st">'No. Nodes'</span>, <span class="st">'No. Edges'</span>, <span class="st">'Avg. Degree'</span>]</span>
<span id="cb12-3"><a href=""></a>interaction_graph_summaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--
```python
#| echo: false
md = markdown_table(interaction_graph_summaries, 'tables/_sir_1_interaction_graph_summaries.md', indexed=True)
# print(md)
```
 -->
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">No.&nbsp;Nodes</th>
<th style="text-align: right;">No.&nbsp;Edges</th>
<th style="text-align: right;">Avg. Degree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">M1</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">984</td>
<td style="text-align: right;">19.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">M2</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">997</td>
<td style="text-align: right;">19.94</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="columns">
<div class="column" style="width:65%;">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href=""></a><span class="co"># Initialize an empty graph</span></span>
<span id="cb13-2"><a href=""></a>G <span class="op">=</span> interaction_graphs[<span class="st">'M2'</span>]</span>
<span id="cb13-3"><a href=""></a>weights <span class="op">=</span> [d[<span class="st">'weight'</span>] <span class="cf">for</span> u, v, d <span class="kw">in</span> G.edges(data<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb13-4"><a href=""></a></span>
<span id="cb13-5"><a href=""></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb13-6"><a href=""></a>sns.ecdfplot(weights)</span>
<span id="cb13-7"><a href=""></a>plt.xlabel(<span class="st">'Interaction Weight'</span>)</span>
<span id="cb13-8"><a href=""></a>plt.ylabel(<span class="st">'ECDF'</span>)</span>
<span id="cb13-9"><a href=""></a>plt.title(<span class="st">'ECDF of Interaction Weights'</span>)</span>
<span id="cb13-10"><a href=""></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb13-11"><a href=""></a>plt.savefig(<span class="st">'media/compare_agent_networks.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--
```python
#| echo: false
# testing something... ignore this... nothing to see here...
for agent in model_2.schedule.agents:
    G.add_node(agent.unique_id)  # Add agent as a node
    for interacted_agent, count in agent.interactions.items():
        if G.has_edge(agent.unique_id, interacted_agent):
            G[agent.unique_id][interacted_agent]['weight'] += count
        else:
            G.add_edge(agent.unique_id, interacted_agent, weight=count)
```
-->
</div><div class="column" style="width:35%;">
<div id="fig-compare_agent_networks" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-compare_agent_networks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/compare_agent_networks.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;5: Model 2 edge weight ECDF."><img data-src="media/compare_agent_networks.png" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-compare_agent_networks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Model 2 edge weight ECDF.
</figcaption>
</figure>
</div>
</div></div>
</section>
<section id="model-analysis" class="slide level2">
<h2>Model Analysis</h2>
<p><br><br></p>
<ul>
<li><p>Understand and interpret model behavior to better understand the system being modeled</p></li>
<li><p>Validate the model against real-world data, check robustness and reliability</p></li>
<li><p>Explore the effects of different parameters and conditions and identify key drivers of model outcomes</p></li>
<li><p>Track agent states, interactions, and other metrics</p></li>
<li><p>Visualize model dynamics over time</p></li>
<li><p>Use statistical or other approaches</p></li>
</ul>
<aside class="notes">
<p>So far we have not been very systematic in how we’ve approaches analyzing the outputs of our SIR model. What’s involved in more systematic analyses?</p>
<p>The primary goal of analyzing an agent-based model is to gain insights into how the model behaves and how well it represents the real-world system it’s designed to simulate. This involves understanding the dynamics of the model, validating it against empirical data, and exploring the implications of different parameter settings.</p>
<p>We can break ABM model analysis down into several types. Descriptive analysis helps summarize what’s happening in the model, while exploratory analysis digs deeper into patterns and relationships within the data. Comparative analysis is useful when we want to understand how different scenarios or versions of the model compare, and predictive analysis leverages the model to forecast future outcomes.</p>
<p>Usually, we use several techniques at once to analyze ABMs effectively. Data collection is crucial for tracking the various states and interactions within the model, often using tools like Mesa’s DataCollector. Visualization helps us see the trends and dynamics within the model, and statistical analysis allows us to quantify and interpret the data meaningfully.</p>
<p>Ultimately, the goal of analyzing an ABM is to ensure that the model is providing accurate, reliable insights into the system being studied. This includes identifying the key factors that drive model outcomes and ensuring that the model can withstand scrutiny through robust analysis.</p>
<p>This high-level overview sets the stage for more detailed discussions on specific analysis methods like sensitivity analysis, parameter sweeps, and computational experiments, which are essential for thoroughly understanding and validating our ABMs.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="model-analysis-1" class="slide level2 scrollable">
<h2>Model Analysis</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:60%;">
<h4 id="sensitivity-analysis"><span class="kn-pink large-text">Sensitivity Analysis</span></h4>
<p>helps determine which model parameters are most important and/or uncertain, and which require careful estimation and interpretation.</p>
<p><br></p>
<h4 id="parameter-sweeps"><span class="kn-pink large-text">Parameter Sweeps</span></h4>
<p>allow for a systematic exploration of how different settings influence model behavior, which helps in understanding the model’s <strong>response landscape</strong>.</p>
<p><br></p>
<h4 id="computational-experiments"><span class="kn-pink large-text">Computational Experiments</span></h4>
<p>involve systematically investigating the model’s behavior to answer specific questions, understand mechanisms, or test hypotheses.</p>
</div><div class="column" style="width:40%;">

</div></div>
<aside class="notes">
<p>When iteratively analyzing models, we can use Sensitivity Analysis, Parameter Sweeps, and Computational Experiments to understand, test, and analyze the behavior of the model under various conditions. These methods are essential for ensuring the model’s reliability and for interpreting its results. Here’s what they mean:</p>
<ol type="1">
<li>Sensitivity Analysis</li>
</ol>
<p>Sensitivity analysis involves systematically varying model parameters to assess how changes in these parameters affect the model’s output. It helps identify which parameters are most influential in determining model behavior and which ones have less impact.</p>
<p>The main goal is to understand how robust the model’s results are. If small changes in a parameter lead to significant changes in outcomes, for example, that parameter is considered sensitive and could indicate areas where the model might need refinement or better data.</p>
<p>Local Sensitivity Analysis involves small variations in one parameter at a time to observe the local impact on the model, whereas Global Sensitivity Analysis considers a broader range of variations and the combined effects of multiple parameters.</p>
<ol start="2" type="1">
<li>Parameter Sweeps</li>
</ol>
<p>This allows us to map out the response of the model across the entire space of possible parameter values, which helps identify trends, tipping points, or regions of parameter space where the model behaves in a particular way. Typically, this is done by running a series of simulations where one or more parameters are adjusted incrementally. The results are then analyzed to understand the relationship between parameters and outcomes.</p>
<ol start="3" type="1">
<li>Computational Experiments:</li>
</ol>
<p>In the context of ABM, computational experiments refer to the process of systematically testing the model by varying initial conditions, parameter values, or model structures to observe the resulting behavior. Most importantly, this is done with the goal of answering scientific questions, understanding mechanisms, or testing hypotheses. Sometimes this is explicitly causal and may be similar to laboratory experiments, only in a simulated environment where variables can easily be manipulated and controlled. Other times it is more exploratory, with the goal of mapping out the model’s behavior across a wide range of conditions.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="deeper-dives-with-batch_run" class="title-slide slide level1 center" data-background-image="media/jeremy-bishop-5MvL55-rSvI-unsplash.jpg">
<h1><span class="pink-monospace"><span class="small-text light-against-image">deeper dives with</span><br>batch_run</span></h1>
<!-- Photo by <a href="https://unsplash.com/@sebaspenalambarri?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Sebastian Pena Lambarri</a> on <a href="https://unsplash.com/photos/two-people-scuba-diving-underwater-7i5HMCGupVw?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
   -->
</section>
<section id="section-7" class="slide level2 scrollable">
<h2></h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>Let’s do a</p>
<p><span class="large-text kn-pink">sensitivity analysis</span></p>
</div><div class="column" style="width:55%;">
<ol type="1">
<li>Set up the <strong>parameter sweep</strong> dictionary</li>
<li>Run the model according to the sweep dictionary<br><span class="nord-light">+ plot results from batch run</span></li>
<li>Aggregate the model results</li>
</ol>
</div></div>
<p><br></p>
<hr style="border: none; border-top: 1px solid black;">
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<p>First, we’ll focus on</p>
<p><span class="large-text">peak proportion infected</span></p>
<p>as the outcome of interest</p>
</div><div class="column" style="width:55%;">
<ol start="4" type="1">
<li>Plot the results</li>
<li>Correlate parameters with peak proportion infected<a href="#/footnotes" class="footnote-ref" id="fnref2" role="doc-noteref" data-footnote-href="#/fn2" onclick=""><sup>2</sup></a></li>
<li>Interpret, critique… <em>repeat?</em></li>
</ol>
</div></div>
<p><br></p>
<hr style="border: none; border-top: 1px solid black;">
<p><br></p>
<div class="columns">
<div class="column" style="width:45%;">
<p>and then</p>
<p><span class="large-text"><strong>time</strong> to peak proportion infected</span></p>
<p>as the outcome of interest</p>
</div><div class="column" style="width:55%;">
<ol start="7" type="1">
<li>Prepare the data</li>
<li>Plot the results</li>
<li>Interpret, critique… <em>repeat?</em></li>
</ol>
</div></div>
<aside class="notes">
<p>Sensitivity plots will show how the peak number of infections varies with changes in each parameter. Parameters with more spread (higher variability in the boxplots) are more sensitive.</p>
<p>The correlation analysis will help identify which parameters have the most substantial impact on the peak number of infections.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside></aside></section>
<section id="sensitivity-analysis-1-set-up-and-2-run" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(1) Set up and (2) run!</span></h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a>params <span class="op">=</span> {</span>
<span id="cb14-2"><a href=""></a>    <span class="st">"N"</span>: <span class="dv">100</span>,</span>
<span id="cb14-3"><a href=""></a>    <span class="st">"grid_height"</span>: <span class="dv">40</span>,</span>
<span id="cb14-4"><a href=""></a>    <span class="st">"grid_width"</span>: <span class="dv">40</span>,</span>
<span id="cb14-5"><a href=""></a>    <span class="st">"infection_rate"</span>: [<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>,],</span>
<span id="cb14-6"><a href=""></a>    <span class="st">"recovery_time_range"</span>: [(<span class="dv">7</span>,<span class="dv">14</span>), (<span class="dv">14</span>,<span class="dv">24</span>)],</span>
<span id="cb14-7"><a href=""></a>    <span class="st">"max_agent_step_size"</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>],</span>
<span id="cb14-8"><a href=""></a>    <span class="st">"n_initial_infections"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>]</span>
<span id="cb14-9"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- _variables! update. -->
</div><div class="column" style="width:25%;">
<p>First, define a dict containing parameter values. Use lists <code>[]</code> to configure the response space.</p>
</div></div>
<p><br></p>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a>results <span class="op">=</span> mesa.batch_run(</span>
<span id="cb15-2"><a href=""></a>    model_cls<span class="op">=</span>SIRModel,</span>
<span id="cb15-3"><a href=""></a>    parameters<span class="op">=</span>params,</span>
<span id="cb15-4"><a href=""></a>    iterations<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb15-5"><a href=""></a>    max_steps<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb15-6"><a href=""></a>    number_processes<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb15-7"><a href=""></a>    data_collection_period<span class="op">=</span><span class="dv">1</span>,  <span class="co"># collect data at every step</span></span>
<span id="cb15-8"><a href=""></a>    display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb15-9"><a href=""></a>)</span>
<span id="cb15-10"><a href=""></a></span>
<span id="cb15-11"><a href=""></a>results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb15-12"><a href=""></a>results_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:25%;">
<p>Then run your model using the <code>batch_run()</code> function.</p>
</div></div>
<!--
```python
#| echo: false
#
# if error on laptop, it's multi-processing in a notebook
# change number_processes to 1
#
results = mesa.batch_run(
    model_cls=SIRModel,
    parameters=params,
    iterations=10,
    max_steps=100,
    number_processes=1,
    data_collection_period=1,
    display_progress=True,
)

results_df = pd.DataFrame(results)
results_df.info()
```
 -->
</section>
<section id="sensitivity-analysis-3-aggregate-results" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(3) Aggregate results</span></h2>
<p><br></p>
<!--
```python
#| echo: false
from icsspy.utils import markdown_table
md = markdown_table(results_df.head(), 'tables/_sir_batch_results_df.md')
print(md)
```
 -->
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href=""></a>results_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table>
<colgroup>
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">RunId</th>
<th style="text-align: right;">iteration</th>
<th style="text-align: right;">Step</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">grid_height</th>
<th style="text-align: right;">grid_width</th>
<th style="text-align: right;">infection_rate</th>
<th style="text-align: left;">recovery_time_range</th>
<th style="text-align: right;">max_agent_step_size</th>
<th style="text-align: right;">n_initial_infections</th>
<th style="text-align: right;">Susceptible</th>
<th style="text-align: right;">Infected</th>
<th style="text-align: right;">Recovered</th>
<th style="text-align: right;">AgentID</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Infection_Duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<!--
```python
#| echo: false
md = markdown_table(results_df.tail(), 'tables/_sir_batch_results_df_tail.md')
print(md)
```
 -->
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href=""></a>results_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table>
<colgroup>
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">RunId</th>
<th style="text-align: right;">iteration</th>
<th style="text-align: right;">Step</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">grid_height</th>
<th style="text-align: right;">grid_width</th>
<th style="text-align: right;">infection_rate</th>
<th style="text-align: left;">recovery_time_range</th>
<th style="text-align: right;">max_agent_step_size</th>
<th style="text-align: right;">n_initial_infections</th>
<th style="text-align: right;">Susceptible</th>
<th style="text-align: right;">Infected</th>
<th style="text-align: right;">Recovered</th>
<th style="text-align: right;">AgentID</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Infection_Duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2879</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: left;">(14, 24)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">50</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: right;">2879</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: left;">(14, 24)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">91</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2879</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: left;">(14, 24)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">74</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">2879</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: left;">(14, 24)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">58</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2879</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: left;">(14, 24)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">68</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
<p><span class="nord-footer">Be selective about the data you collect during a batch run. I collected everything (including things that don’t vary) here for pedagogical reasons only!</span></p>
<!-- Another run I did with this model produced a 4GB text file with only 6 variables. So, yeah. -->
</section>
<section id="section-8" class="slide level2">
<h2></h2>
<p>We can compare some high-level patterns by creating a <strong>small multiples</strong> plot. We’ll use Seaborn’s <strong>FacePlot</strong> for this. It’s a more complex setup than other plotting code we’ve used so far, so if it’s a bit overwhelming just focus on interpreting the output. Note that this code will take a little while to run.<a href="#/footnotes" class="footnote-ref" id="fnref3" role="doc-noteref" data-footnote-href="#/fn3" onclick=""><sup>3</sup></a></p>
<p><br></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href=""></a>melted_df <span class="op">=</span> pd.melt(</span>
<span id="cb18-2"><a href=""></a>    results_df,</span>
<span id="cb18-3"><a href=""></a>    <span class="co"># include 'RunId' to differentiate runs</span></span>
<span id="cb18-4"><a href=""></a>    id_vars<span class="op">=</span>[<span class="st">'n_initial_infections'</span>, <span class="st">'infection_rate'</span>, <span class="st">'Step'</span>, <span class="st">'RunId'</span>],</span>
<span id="cb18-5"><a href=""></a>    value_vars<span class="op">=</span>[<span class="st">'Susceptible'</span>, <span class="st">'Infected'</span>, <span class="st">'Recovered'</span>],</span>
<span id="cb18-6"><a href=""></a>    var_name<span class="op">=</span><span class="st">'State'</span>,</span>
<span id="cb18-7"><a href=""></a>    value_name<span class="op">=</span><span class="st">'Proportion'</span></span>
<span id="cb18-8"><a href=""></a>)</span>
<span id="cb18-9"><a href=""></a></span>
<span id="cb18-10"><a href=""></a><span class="co"># create the FacetGrid</span></span>
<span id="cb18-11"><a href=""></a>g <span class="op">=</span> sns.FacetGrid(</span>
<span id="cb18-12"><a href=""></a>    melted_df, col<span class="op">=</span><span class="st">"n_initial_infections"</span>, hue<span class="op">=</span><span class="st">"State"</span>,</span>
<span id="cb18-13"><a href=""></a>    col_wrap<span class="op">=</span><span class="dv">3</span>, height<span class="op">=</span><span class="dv">4</span>, aspect<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb18-14"><a href=""></a>)</span>
<span id="cb18-15"><a href=""></a></span>
<span id="cb18-16"><a href=""></a><span class="co"># map the scatterplot for individual observations</span></span>
<span id="cb18-17"><a href=""></a>g.map_dataframe(</span>
<span id="cb18-18"><a href=""></a>    sns.scatterplot, x<span class="op">=</span><span class="st">'Step'</span>, y<span class="op">=</span><span class="st">'Proportion'</span>, alpha<span class="op">=</span><span class="fl">0.005</span>, edgecolor<span class="op">=</span><span class="va">None</span></span>
<span id="cb18-19"><a href=""></a>)</span>
<span id="cb18-20"><a href=""></a></span>
<span id="cb18-21"><a href=""></a><span class="co"># map the lineplot for aggregated data</span></span>
<span id="cb18-22"><a href=""></a>g.map_dataframe(</span>
<span id="cb18-23"><a href=""></a>    sns.lineplot, x<span class="op">=</span><span class="st">'Step'</span>, y<span class="op">=</span><span class="st">'Proportion'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb18-24"><a href=""></a>)</span>
<span id="cb18-25"><a href=""></a></span>
<span id="cb18-26"><a href=""></a>g.add_legend()</span>
<span id="cb18-27"><a href=""></a>g.set_axis_labels(<span class="st">"Time Step"</span>, <span class="st">"Proportion"</span>)</span>
<span id="cb18-28"><a href=""></a>g.set_titles(<span class="st">"Initial Infections: </span><span class="sc">{col_name}</span><span class="st">"</span>)</span>
<span id="cb18-29"><a href=""></a></span>
<span id="cb18-30"><a href=""></a>plt.savefig(<span class="st">"media/sir_subplots.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside></aside></section>
<section id="section-9" class="slide level2">
<h2></h2>
<div id="fig-sir_subplots" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-sir_subplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/sir_subplots.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;6: Batch results for Model 2 with mean trends emphasized."><img data-src="media/sir_subplots.png" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sir_subplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Batch results for Model 2 with mean trends emphasized.
</figcaption>
</figure>
</div>
</section>
<section id="sensitivity-analysis-3-aggregate-results-1" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(3) Aggregate results</span></h2>
<p><br></p>
<p>Next, we aggregate results to get the peak number of infections per run.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href=""></a>aggregated_results <span class="op">=</span> results_df.groupby([<span class="st">"RunId"</span>, <span class="st">"infection_rate"</span>, <span class="st">"recovery_time_range"</span>, <span class="st">"max_agent_step_size"</span>, <span class="st">"n_initial_infections"</span>]).agg(</span>
<span id="cb19-2"><a href=""></a>    peak_infected<span class="op">=</span>(<span class="st">"Infected"</span>, <span class="st">"max"</span>)</span>
<span id="cb19-3"><a href=""></a>).reset_index()</span>
<span id="cb19-4"><a href=""></a></span>
<span id="cb19-5"><a href=""></a>aggregated_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--

```python
#| echo: false
md = markdown_table(aggregated_results.head(), 'tables/_sir_sensitivity_aggregated.md')
print(md)
``` -->
<table>
<colgroup>
<col style="width: 7%">
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">RunId</th>
<th style="text-align: right;">infection_rate</th>
<th style="text-align: left;">recovery_time_range</th>
<th style="text-align: right;">max_agent_step_size</th>
<th style="text-align: right;">n_initial_infections</th>
<th style="text-align: right;">peak_infected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">(7, 14)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.36</td>
</tr>
</tbody>
</table>
</section>
<section id="sensitivity-analysis-4-plot-and-6-interpret" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(4) Plot and (6) Interpret</span></h2>
<p><br></p>
<p>We’ll need to convert the <code>recovery_time_range</code> tuples into strings for plotting.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href=""></a>aggregated_results[<span class="st">'recovery_time_range_str'</span>] <span class="op">=</span> aggregated_results[<span class="st">'recovery_time_range'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>x[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>And then we can set up the plot.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href=""></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-2"><a href=""></a></span>
<span id="cb21-3"><a href=""></a><span class="co"># infection rate</span></span>
<span id="cb21-4"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"infection_rate"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb21-5"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(a) Sensitivity to Infection Rate"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb21-6"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Infection Rate"</span>)</span>
<span id="cb21-7"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-8"><a href=""></a></span>
<span id="cb21-9"><a href=""></a><span class="co"># recovery time range (use the string version we just created)</span></span>
<span id="cb21-10"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"recovery_time_range_str"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb21-11"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(b) Sensitivity to Recovery Time Range"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb21-12"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Recovery Time Range"</span>)</span>
<span id="cb21-13"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-14"><a href=""></a></span>
<span id="cb21-15"><a href=""></a><span class="co"># max agent step size</span></span>
<span id="cb21-16"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"max_agent_step_size"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb21-17"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(c) Sensitivity to Max Agent Step Size"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb21-18"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Max Agent Step Size"</span>)</span>
<span id="cb21-19"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-20"><a href=""></a></span>
<span id="cb21-21"><a href=""></a><span class="co"># initial infections</span></span>
<span id="cb21-22"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"n_initial_infections"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb21-23"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(d) Sensitivity to Initial Infections"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb21-24"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Initial Infections"</span>)</span>
<span id="cb21-25"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-26"><a href=""></a></span>
<span id="cb21-27"><a href=""></a>plt.tight_layout()</span>
<span id="cb21-28"><a href=""></a>plt.savefig(<span class="st">"media/sir_sensitivity_analysis.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensitivity-analysis-4-plot-the-results" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(4) Plot the results</span></h2>
<div id="fig-sir_sensitivity_analysis" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-sir_sensitivity_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/sir_sensitivity_analysis.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;7: Sensitivity plot for our SIR model parameters and peak proportion infected across all model runs."><img data-src="media/sir_sensitivity_analysis.png" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sir_sensitivity_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Sensitivity plot for our SIR model parameters and peak proportion infected across all model runs.
</figcaption>
</figure>
</div>
</section>
<section id="sensitivity-analysis-5-correlate" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(5) Correlate</span></h2>
<p><br></p>
<p>As an additional step, we can correlate our parameters with the peak proportion infected to get a sense of relative influence. To do so, we have to transform the recovery time ranges into a single number. There are a few ways we could do this, but to keep things simple we’ll take the mean of the two values.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href=""></a>aggregated_results[<span class="st">"recovery_time_range_numeric"</span>] <span class="op">=</span> aggregated_results[<span class="st">"recovery_time_range"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">sum</span>(x) <span class="op">/</span> <span class="bu">len</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Once we’ve done that, we’ll drop the original tuple (<code>recovery_time_range</code>) and it’s string representation (<code>recovery_time_range_str</code>). I’ll create a new dataframe for these modifications, since we’ll use the dropped variables in our second sensitivity analysis.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href=""></a>aggregated_results_4corr <span class="op">=</span> aggregated_results.copy()</span>
<span id="cb23-2"><a href=""></a>aggregated_results_4corr.drop([<span class="st">'recovery_time_range'</span>, <span class="st">'recovery_time_range_str'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensitivity-analysis-5-correlate-1" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(5) Correlate</span></h2>
<p><br></p>
<p>And now we can correlate!</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href=""></a>correlation_matrix <span class="op">=</span> aggregated_results_4corr.corr()</span>
<span id="cb24-2"><a href=""></a>peak_infected_correlations <span class="op">=</span> correlation_matrix[<span class="st">"peak_infected"</span>].drop(</span>
<span id="cb24-3"><a href=""></a>    [<span class="st">"peak_infected"</span>, <span class="st">"RunId"</span>]</span>
<span id="cb24-4"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>It’s common to visualize the results with a bar chart, but I prefer to compare the correlations using the same line comparison plots we used for model comparison in the module on generative network modelling. To create it, we’ll create a dict with the parameter names and correlations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href=""></a>for_plotting <span class="op">=</span> {}</span>
<span id="cb25-2"><a href=""></a><span class="cf">for</span> parameter, correlation <span class="kw">in</span> <span class="bu">zip</span>(peak_infected_correlations.index, peak_infected_correlations.values):</span>
<span id="cb25-3"><a href=""></a>    for_plotting[parameter] <span class="op">=</span> <span class="bu">round</span>(correlation, <span class="dv">4</span>)</span>
<span id="cb25-4"><a href=""></a></span>
<span id="cb25-5"><a href=""></a>plot_line_comparison(</span>
<span id="cb25-6"><a href=""></a>    for_plotting,</span>
<span id="cb25-7"><a href=""></a>    <span class="bu">xrange</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># all positive correlations</span></span>
<span id="cb25-8"><a href=""></a>    print_decimals<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-9"><a href=""></a>    title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb25-10"><a href=""></a>    xlabel<span class="op">=</span><span class="st">'</span><span class="ch">\n</span><span class="st">Correlations between model parameters and peak infection.'</span>,</span>
<span id="cb25-11"><a href=""></a>    filename<span class="op">=</span><span class="st">"media/sir_correlations_params_peak_infection.png"</span></span>
<span id="cb25-12"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensitivity-analysis-6-interpret" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(6) Interpret</span></h2>
<p><br><br></p>
<div id="fig-sir_correlations_params_peak_infection" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-sir_correlations_params_peak_infection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/sir_correlations_params_peak_infection.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22" title="Figure&nbsp;8: Correlations between model parameters and peak infection proportion."><img data-src="media/sir_correlations_params_peak_infection.png" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sir_correlations_params_peak_infection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Correlations between model parameters and peak infection proportion.
</figcaption>
</figure>
</div>
</section>
<section id="sensitivity-analysis-7-prepare-the-data-time-to-peak-proportion-infected" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(7) Prepare the data</span><br><span class="small-text">Time to Peak Proportion Infected</span></h2>
<p><br></p>
<p>We have to do a bit more data prep.</p>
<ul>
<li>Group the data by <code>RunId</code> and find the step with the maximum number of infections for each run</li>
<li>Extract the relevant columns: <code>RunId</code>, <code>Step</code> (time to peak), and <code>Infected</code> (peak infections)</li>
<li>Merge with the original parameter data</li>
</ul>
<p>After this, <code>time_to_peak_merged</code> will contain the data on time to peak infection along with the parameters used in each run.</p>
<p><br></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href=""></a>time_to_peak <span class="op">=</span> results_df.loc[results_df.groupby(<span class="st">"RunId"</span>)[<span class="st">"Infected"</span>].idxmax()]</span>
<span id="cb26-2"><a href=""></a>time_to_peak <span class="op">=</span> time_to_peak[[<span class="st">"RunId"</span>, <span class="st">"Step"</span>, <span class="st">"Infected"</span>]].rename(</span>
<span id="cb26-3"><a href=""></a>    columns<span class="op">=</span>{<span class="st">"Step"</span>: <span class="st">"time_to_peak"</span>, <span class="st">"Infected"</span>: <span class="st">"peak_infected"</span>}</span>
<span id="cb26-4"><a href=""></a>)</span>
<span id="cb26-5"><a href=""></a></span>
<span id="cb26-6"><a href=""></a>time_to_peak_merged <span class="op">=</span> pd.merge(time_to_peak, aggregated_results, on<span class="op">=</span><span class="st">"RunId"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensitivity-analysis-8-plot-and-9-interpret-time-to-peak-proportion-infected" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(8) Plot and (9) Interpret</span><br><span class="small-text">Time to Peak Proportion Infected</span></h2>
<p><br></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href=""></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-2"><a href=""></a></span>
<span id="cb27-3"><a href=""></a><span class="co"># Infection rate</span></span>
<span id="cb27-4"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"infection_rate"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb27-5"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(a) Time to Peak Infection vs. Infection Rate"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-6"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Infection Rate"</span>)</span>
<span id="cb27-7"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-8"><a href=""></a></span>
<span id="cb27-9"><a href=""></a><span class="co"># Recovery time range</span></span>
<span id="cb27-10"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"recovery_time_range_str"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb27-11"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(b) Time to Peak Infection vs. Recovery Time Range"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-12"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Recovery Time Range"</span>)</span>
<span id="cb27-13"><a href=""></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-14"><a href=""></a></span>
<span id="cb27-15"><a href=""></a><span class="co"># Max agent step size</span></span>
<span id="cb27-16"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"max_agent_step_size"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb27-17"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(c) Time to Peak Infection vs. Max Agent Step Size"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-18"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Max Agent Step Size"</span>)</span>
<span id="cb27-19"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-20"><a href=""></a></span>
<span id="cb27-21"><a href=""></a><span class="co"># Initial infections</span></span>
<span id="cb27-22"><a href=""></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"n_initial_infections"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb27-23"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(d) Time to Peak Infection vs. Initial Infections"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb27-24"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Initial Infections"</span>)</span>
<span id="cb27-25"><a href=""></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-26"><a href=""></a></span>
<span id="cb27-27"><a href=""></a>plt.tight_layout()</span>
<span id="cb27-28"><a href=""></a>plt.savefig(<span class="st">"media/sir_time_to_peak_analysis.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensitivity-analysis-8-plot-and-9-interpret-time-to-peak-proportion-infected-1" class="slide level2">
<h2>Sensitivity Analysis <span class="nord-light">(8) Plot and (9) Interpret</span><br><span class="small-text">Time to Peak Proportion Infected</span></h2>
<div id="fig-sir_time_to_peak_analysis" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-sir_time_to_peak_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/sir_time_to_peak_analysis.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23" title="Figure&nbsp;9: Sensitivity plot for our SIR model parameters and time to peak proportion infected across all model runs."><img data-src="media/sir_time_to_peak_analysis.png" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sir_time_to_peak_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Sensitivity plot for our SIR model parameters and time to peak proportion infected across all model runs.
</figcaption>
</figure>
</div>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p><br><br><br></p>
<div class="columns">
<div class="column" style="width:55%;">
<p>There is much more we could do here,<br><strong>but let’s move on to a different example.</strong></p>
</div><div class="column" style="width:45%;">

</div></div>
</section></section>
<section>
<section id="social-learning-influence-and-opinion-dynamics" class="title-slide slide level1 center">
<h1><span class="small-text">Social Learning, Influence, and</span><br>Opinion Dynamics</h1>

</section>
<section id="opinion-dynamics" class="slide level2">
<h2>Opinion Dynamics</h2>
<p><br><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<h4 id="central-questions">Central Questions</h4>
<p><span class="math inline">\(\longrightarrow\)</span></p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:70%;">
<p>How do opinions form, cluster, and change in populations? How do populations reach opinion consensus, polarization, or fragmentation? What are the key drivers of formation, clustering, change, as well as population-level consensus, polarization, or fragmentation? What are the roles played by: the structure and dynamics of multi-layer social networks; disinformation and propaganda; echo chambers and filter bubbles; agent cognition, emotion, and identity, etc.? How do we best model diversity and heterogenous populations?</p>
<p><br></p>
<p><span class="large-text"><strong>Bounded Confidence Models (BCE)</strong></span></p>
<p>BCMs simulate opinion evolution in a continuous opinion space. People interact and influence each other if their opinions are within a certain threshold (<span class="math inline">\(\epsilon\)</span>).</p>
<ul>
<li>Agents have continuous opinions (e.g., -1 to 1).</li>
<li>A Confidence Bound (<span class="math inline">\(\epsilon\)</span>) determines the range within which agents are influenced by others.</li>
<li>In interactions, agents adjust opinions if the difference between their opinion and their alter’s opinion is within their confidence bound.</li>
<li>The outcome is typically opinion clusters indicating polarization, fragmentation, or consensus.</li>
</ul>
</div></div>
<aside class="notes">
<p>Opinion dynamics research is a key area in computational social science, focusing on how individuals’ opinions are shaped and how these opinions influence group decisions.</p>
<p>This research is especially relevant to understanding phenomena like political polarization, consensus formation in teams, and the spread of misinformation.</p>
<p>In this part of the lecture, we’ll explore one of the foundational models in opinion dynamics: the Bounded Confidence Model (BCM), which offers a way to understand how opinions evolve when individuals are influenced only by those with similar views.</p>
<p>The Bounded Confidence Model was introduced as a way to simulate how people influence each other’s opinions when they only engage with those who hold similar views.</p>
<p>This model is particularly powerful for studying polarization, where society splits into groups with opposing opinions, and for understanding the conditions under which consensus can be reached.</p>
<p>Let’s break down the components of a Bounded Confidence Model:</p>
<p>Agents: Each agent represents an individual with an opinion, typically modeled as a number between -1 and 1.</p>
<p>Confidence Bound (<span class="math inline">\(\epsilon\)</span>): This is a critical parameter. It represents how open an agent is to interacting with others. If another agent’s opinion is within this bound, they will influence each other.</p>
<p>Interaction: When two agents interact, they adjust their opinions towards each other. This models the idea of social influence, where people often adjust their views based on those they interact with.</p>
<p>Outcome: Depending on the value of <span class="math inline">\(\epsilon\)</span> and the initial distribution of opinions, the model can result in different outcomes: the formation of distinct opinion clusters, complete polarization, or consensus.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-11" class="slide level2" data-background-color="#F0F0F0">
<h2></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div style="background-color: white; padding: 80px; width: 75%; height: 600px; overflow-y: scroll; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
<h3 id="odd-protocol-for-the-bounded-confidence-model-bcm">ODD Protocol for the Bounded Confidence Model (BCM)</h3>
<h4 id="overview">1. <strong>Overview</strong></h4>
<p><strong>Purpose of the Model</strong>:</p>
<p>The Bounded Confidence Model (BCM) simulates opinion dynamics in a continuous opinion space. It models how agents’ opinions evolve over time through interactions with other agents within a predefined confidence bound (<span class="math inline">\(\epsilon\)</span>). The model is used to study phenomena such as opinion polarization, consensus formation, and the effect of varying confidence bounds on these processes.</p>
<p><strong>Entities, State Variables, and Scales</strong>:</p>
<ul>
<li><strong>Agents</strong>: Each agent has an <strong>opinion</strong> represented as a continuous value between -1 and 1, an <strong>epsilon</strong> representing their confidence bound, a <strong>max_agent_step_size</strong> representing their movement capability in a spatial grid, a <strong>pos_history</strong> to track their spatial positions over time, and an <strong>interactions</strong> dictionary to record the frequency of interactions with other agents.</li>
<li><strong>Environment</strong>: The agents are placed on a <strong>MultiGrid</strong> of size defined by <strong>grid_width</strong> and <strong>grid_height</strong>. The grid is toroidal (agents moving off one edge of the grid reappear on the opposite edge).</li>
<li><strong>Scale</strong>: The model runs for a user-defined number of steps (<strong>n_iterations</strong>). The scale of opinions is continuous between -1 and 1.</li>
</ul>
<p><strong>Process Overview</strong>:</p>
<ul>
<li>Agents move to new positions on the grid based on their step size.</li>
<li>Agents interact with neighboring agents within their confidence bound (<span class="math inline">\(\epsilon\)</span>), potentially updating their opinions.</li>
<li>The model tracks the evolution of opinions over time, and data is collected for further analysis.</li>
</ul>
<h4 id="design-concepts-1">2. <strong>Design Concepts</strong></h4>
<p><strong>Basic Principles</strong>:</p>
<ul>
<li><strong>Bounded Confidence</strong>: Agents only interact with others whose opinions differ by less than a threshold value, <strong><span class="math inline">\(\epsilon\)</span></strong>. This models the idea that individuals are only influenced by those whose views are not too dissimilar from their own.</li>
<li><strong>Opinion Averaging</strong>: When two agents interact within this bound, they adjust their opinions to the average of their own and the interacting agent’s opinion.</li>
</ul>
<p><strong>Emergence</strong>:</p>
<ul>
<li>The emergence of opinion clusters, polarization, or consensus depending on the value of <strong><span class="math inline">\(\epsilon\)</span></strong>.</li>
<li>The effect of varying confidence bounds on the structure and distribution of opinions across the agent population.</li>
</ul>
<p><strong>Adaptation</strong>:</p>
<ul>
<li>Agents adapt their opinions based on interactions with their neighbors if those neighbors fall within their confidence bound.</li>
</ul>
<p><strong>Objectives</strong>:</p>
<ul>
<li>The primary objective for the agents is to update their opinions through interactions. The model tracks how the average pairwise opinion similarity evolves over time.</li>
</ul>
<p><strong>Learning</strong>:</p>
<ul>
<li>Agents do not learn in a traditional sense, but they do update their opinions based on interactions.</li>
</ul>
<p><strong>Prediction</strong>:</p>
<ul>
<li>Agents do not explicitly predict future states but react to the current opinions of their neighbors within the confidence bound.</li>
</ul>
<p><strong>Sensing</strong>:</p>
<ul>
<li>Agents can sense the opinions of their immediate neighbors on the grid.</li>
</ul>
<p><strong>Interaction</strong>:</p>
<ul>
<li>Interaction occurs between agents occupying neighboring grid cells, where they compare opinions and possibly adjust their own.</li>
</ul>
<p><strong>Stochasticity</strong>:</p>
<ul>
<li>Agents’ initial opinions are randomly assigned within the range [-1, 1].</li>
<li>Movement is stochastic, with agents choosing a random neighboring cell to move to in each step.</li>
</ul>
<p><strong>Collectives</strong>:</p>
<ul>
<li>No formal collective structures are defined, though clusters of agents with similar opinions may emerge naturally.</li>
</ul>
<p><strong>Observation</strong>:</p>
<ul>
<li>The model observes and records <strong>Opinion</strong> for each agent at each time step.</li>
<li>It also records a global measure, <strong>Avg_Similarity</strong>, which represents the average pairwise similarity of opinions across the population.</li>
</ul>
<h4 id="details">3. <strong>Details</strong></h4>
<p><strong>Initialization</strong>:</p>
<ul>
<li>The model initializes with <strong>N</strong> agents, each placed randomly on a grid of size <strong>grid_width x grid_height</strong>.</li>
<li>Each agent’s opinion is initialized as a random value between -1 and 1.</li>
<li>Agents are given a confidence bound, <strong><span class="math inline">\(\epsilon\)</span></strong>, which defines their bounded confidence interval.</li>
</ul>
<p><strong>Input Data</strong>:</p>
<ul>
<li>The model can be initialized with parameters loaded from an external YAML file. The parameters typically include the number of agents, the grid size, the confidence bound (<strong><span class="math inline">\(\epsilon\)</span></strong>), the maximum step size for agent movement, and the number of iterations.</li>
</ul>
<p><strong>Submodels</strong>:</p>
<ul>
<li><p><strong>BCMAgent</strong>:</p></li>
<li><p>The agent’s <strong>step</strong> method handles movement, interaction with neighbors, and opinion updating.</p></li>
<li><p>Each agent decides on a random new position within a certain range (defined by <strong>max_agent_step_size</strong>), then interacts with its neighbors within the confidence bound to potentially update its opinion.</p></li>
<li><p><strong>BoundedConfidenceModel</strong>:</p></li>
<li><p>The <strong>step</strong> method handles the collection of data and agent activation for each time step.</p></li>
<li><p>The model includes a method to calculate the average similarity of opinions (<strong>calculate_similarity</strong>), which is used to observe the convergence of opinions across the population.</p></li>
</ul>
<h3 id="execution-of-the-model">Execution of the Model</h3>
<ul>
<li>The model runs for a predefined number of iterations, during which agents move, interact, and update their opinions. Data is collected at each step for post-simulation analysis, allowing for the observation of opinion dynamics under varying conditions of bounded confidence (<strong><span class="math inline">\(\epsilon\)</span></strong>).</li>
</ul>
</div>
</div><div class="column" style="width:25%;">
<p>ODD Protocol for Bounded Confidence Model<br><span class="math inline">\(\longleftarrow\)</span></p>
<p><br></p>
<div class="quarto-figure quarto-figure-left">
<figure>
<p><a href="media/odd.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24" title="Figure reproduced from @railsback2019agent."><img data-src="media/odd.png" class="shadow-img" style="width:100.0%" alt="Figure reproduced from Railsback and Grimm (2019)."></a></p>
<figcaption><span class="nord-light">Figure reproduced from <span class="citation" data-cites="railsback2019agent">Railsback and Grimm (<a href="#/section-16" role="doc-biblioref" onclick="">2019</a>)</span>.</span></figcaption>
</figure>
</div>
</div></div>
</section>
<section id="imports" class="slide level2">
<h2>Imports</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href=""></a><span class="im">from</span> mesa <span class="im">import</span> Agent</span>
<span id="cb28-2"><a href=""></a><span class="im">from</span> mesa <span class="im">import</span> Model</span>
<span id="cb28-3"><a href=""></a><span class="im">from</span> mesa.space <span class="im">import</span> MultiGrid</span>
<span id="cb28-4"><a href=""></a><span class="im">from</span> mesa.time <span class="im">import</span> RandomActivation</span>
<span id="cb28-5"><a href=""></a><span class="im">from</span> mesa.datacollection <span class="im">import</span> DataCollector</span>
<span id="cb28-6"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-7"><a href=""></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb28-8"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-9"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-10"><a href=""></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb28-11"><a href=""></a><span class="im">import</span> yaml</span>
<span id="cb28-12"><a href=""></a></span>
<span id="cb28-13"><a href=""></a><span class="im">import</span> icsspy</span>
<span id="cb28-14"><a href=""></a>icsspy.set_style()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bcm-the-agent-class" class="slide level2">
<h2><span class="lightgray">(BCM)</span> The Agent Class</h2>
<p><br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href=""></a><span class="kw">class</span> BCMAgent(Agent):</span>
<span id="cb29-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, unique_id, model, epsilon, max_agent_step_size<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb29-3"><a href=""></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(unique_id, model)</span>
<span id="cb29-4"><a href=""></a>        <span class="va">self</span>.opinion <span class="op">=</span> <span class="va">self</span>.random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Agent's opinion initialized between -1 and 1</span></span>
<span id="cb29-5"><a href=""></a>        <span class="va">self</span>.epsilon <span class="op">=</span> epsilon  <span class="co"># Confidence bound ($\epsilon$)</span></span>
<span id="cb29-6"><a href=""></a>        <span class="va">self</span>.max_agent_step_size <span class="op">=</span> max_agent_step_size  <span class="co"># Step size for movement</span></span>
<span id="cb29-7"><a href=""></a>        <span class="va">self</span>.pos_history <span class="op">=</span> []  <span class="co"># Track agent's position over time</span></span>
<span id="cb29-8"><a href=""></a>        <span class="va">self</span>.interactions <span class="op">=</span> {}  <span class="co"># Track interactions with a count</span></span>
<span id="cb29-9"><a href=""></a></span>
<span id="cb29-10"><a href=""></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb29-11"><a href=""></a>        <span class="co"># Move to a random neighboring cell with the given step size</span></span>
<span id="cb29-12"><a href=""></a>        possible_moves <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighborhood(<span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span>, radius<span class="op">=</span><span class="va">self</span>.max_agent_step_size)</span>
<span id="cb29-13"><a href=""></a>        new_position <span class="op">=</span> <span class="va">self</span>.random.choice(possible_moves)</span>
<span id="cb29-14"><a href=""></a>        <span class="va">self</span>.model.grid.move_agent(<span class="va">self</span>, new_position)</span>
<span id="cb29-15"><a href=""></a>        <span class="va">self</span>.pos_history.append(new_position)  <span class="co"># Record the new position</span></span>
<span id="cb29-16"><a href=""></a></span>
<span id="cb29-17"><a href=""></a>        <span class="co"># Interact with neighbors within confidence bound</span></span>
<span id="cb29-18"><a href=""></a>        neighbors <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighbors(<span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-19"><a href=""></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb29-20"><a href=""></a>            <span class="cf">if</span> <span class="bu">abs</span>(<span class="va">self</span>.opinion <span class="op">-</span> neighbor.opinion) <span class="op">&lt;=</span> <span class="va">self</span>.epsilon:</span>
<span id="cb29-21"><a href=""></a>                <span class="co"># Update opinion if within confidence bound</span></span>
<span id="cb29-22"><a href=""></a>                <span class="va">self</span>.opinion <span class="op">=</span> (<span class="va">self</span>.opinion <span class="op">+</span> neighbor.opinion) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb29-23"><a href=""></a></span>
<span id="cb29-24"><a href=""></a>            <span class="co"># Record interactions</span></span>
<span id="cb29-25"><a href=""></a>            <span class="cf">if</span> neighbor.unique_id <span class="kw">in</span> <span class="va">self</span>.interactions:</span>
<span id="cb29-26"><a href=""></a>                <span class="va">self</span>.interactions[neighbor.unique_id] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-27"><a href=""></a>            <span class="cf">else</span>:</span>
<span id="cb29-28"><a href=""></a>                <span class="va">self</span>.interactions[neighbor.unique_id] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bcm-the-model-class" class="slide level2">
<h2><span class="lightgray">(BCM)</span> The Model Class</h2>
<p><br></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href=""></a><span class="kw">class</span> BoundedConfidenceModel(Model):</span>
<span id="cb30-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, grid_width, grid_height, N, epsilon, max_agent_step_size<span class="op">=</span><span class="dv">1</span>, max_steps<span class="op">=</span><span class="dv">1000</span>, convergence_threshold<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb30-3"><a href=""></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb30-4"><a href=""></a>        <span class="va">self</span>.num_agents <span class="op">=</span> N</span>
<span id="cb30-5"><a href=""></a>        <span class="va">self</span>.grid <span class="op">=</span> MultiGrid(grid_width, grid_height, <span class="va">True</span>)</span>
<span id="cb30-6"><a href=""></a>        <span class="va">self</span>.schedule <span class="op">=</span> RandomActivation(<span class="va">self</span>)</span>
<span id="cb30-7"><a href=""></a>        <span class="va">self</span>.epsilon <span class="op">=</span> epsilon</span>
<span id="cb30-8"><a href=""></a>        <span class="va">self</span>.max_agent_step_size <span class="op">=</span> max_agent_step_size</span>
<span id="cb30-9"><a href=""></a>        <span class="va">self</span>.max_steps <span class="op">=</span> max_steps</span>
<span id="cb30-10"><a href=""></a>        <span class="va">self</span>.convergence_threshold <span class="op">=</span> convergence_threshold</span>
<span id="cb30-11"><a href=""></a></span>
<span id="cb30-12"><a href=""></a>        <span class="co"># Initialize step_count</span></span>
<span id="cb30-13"><a href=""></a>        <span class="va">self</span>.step_count <span class="op">=</span> <span class="dv">0</span>  <span class="co"># This will track the number of steps taken</span></span>
<span id="cb30-14"><a href=""></a></span>
<span id="cb30-15"><a href=""></a>        <span class="co"># Create agents</span></span>
<span id="cb30-16"><a href=""></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.num_agents):</span>
<span id="cb30-17"><a href=""></a>            step_size <span class="op">=</span> max_agent_step_size <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">1</span>  <span class="co"># Half agents have large step size, half small</span></span>
<span id="cb30-18"><a href=""></a>            agent <span class="op">=</span> BCMAgent(i, <span class="va">self</span>, epsilon, max_agent_step_size<span class="op">=</span>step_size)</span>
<span id="cb30-19"><a href=""></a>            <span class="va">self</span>.grid.place_agent(agent, (<span class="va">self</span>.random.randrange(<span class="va">self</span>.grid.width),</span>
<span id="cb30-20"><a href=""></a>                                          <span class="va">self</span>.random.randrange(<span class="va">self</span>.grid.height)))</span>
<span id="cb30-21"><a href=""></a>            agent.pos_history.append(agent.pos)  <span class="co"># Initialize the position history with the starting position</span></span>
<span id="cb30-22"><a href=""></a>            <span class="va">self</span>.schedule.add(agent)</span>
<span id="cb30-23"><a href=""></a></span>
<span id="cb30-24"><a href=""></a>        <span class="va">self</span>.datacollector <span class="op">=</span> DataCollector(</span>
<span id="cb30-25"><a href=""></a>            agent_reporters<span class="op">=</span>{<span class="st">"Opinion"</span>: <span class="st">"opinion"</span>},</span>
<span id="cb30-26"><a href=""></a>            model_reporters<span class="op">=</span>{<span class="st">"Avg_Similarity"</span>: <span class="va">self</span>.calculate_similarity}</span>
<span id="cb30-27"><a href=""></a>        )</span>
<span id="cb30-28"><a href=""></a></span>
<span id="cb30-29"><a href=""></a>    <span class="kw">def</span> calculate_similarity(<span class="va">self</span>):</span>
<span id="cb30-30"><a href=""></a>        <span class="co">"""Calculate average pairwise similarity in agent opinions."""</span></span>
<span id="cb30-31"><a href=""></a>        opinions <span class="op">=</span> np.array([agent.opinion <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents])</span>
<span id="cb30-32"><a href=""></a>        pairwise_diffs <span class="op">=</span> np.<span class="bu">abs</span>(opinions[:, <span class="va">None</span>] <span class="op">-</span> opinions[<span class="va">None</span>, :])</span>
<span id="cb30-33"><a href=""></a>        similarity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> pairwise_diffs  <span class="co"># Similarity is inverse of difference</span></span>
<span id="cb30-34"><a href=""></a>        avg_similarity <span class="op">=</span> np.mean(similarity)</span>
<span id="cb30-35"><a href=""></a>        <span class="cf">return</span> avg_similarity</span>
<span id="cb30-36"><a href=""></a></span>
<span id="cb30-37"><a href=""></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb30-38"><a href=""></a>        <span class="va">self</span>.datacollector.collect(<span class="va">self</span>)</span>
<span id="cb30-39"><a href=""></a>        <span class="va">self</span>.schedule.step()</span>
<span id="cb30-40"><a href=""></a>        <span class="va">self</span>.step_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-41"><a href=""></a></span>
<span id="cb30-42"><a href=""></a>        <span class="co"># Check stopping conditions</span></span>
<span id="cb30-43"><a href=""></a>        <span class="cf">if</span> <span class="va">self</span>.check_convergence() <span class="kw">or</span> <span class="va">self</span>.step_count <span class="op">&gt;=</span> <span class="va">self</span>.max_steps:</span>
<span id="cb30-44"><a href=""></a>            <span class="va">self</span>.running <span class="op">=</span> <span class="va">False</span></span>
<span id="cb30-45"><a href=""></a></span>
<span id="cb30-46"><a href=""></a>    <span class="kw">def</span> check_convergence(<span class="va">self</span>):</span>
<span id="cb30-47"><a href=""></a>        <span class="co">"""Check if the opinions have converged."""</span></span>
<span id="cb30-48"><a href=""></a>        opinions <span class="op">=</span> np.array([agent.opinion <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents])</span>
<span id="cb30-49"><a href=""></a>        max_diff <span class="op">=</span> np.<span class="bu">max</span>(np.<span class="bu">abs</span>(opinions[:, <span class="va">None</span>] <span class="op">-</span> opinions[<span class="va">None</span>, :]))</span>
<span id="cb30-50"><a href=""></a>        <span class="cf">return</span> max_diff <span class="op">&lt;</span> <span class="va">self</span>.convergence_threshold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bcm-model-parameters" class="slide level2">
<h2><span class="lightgray">(BCM)</span> Model Parameters</h2>
<p><br></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'_variables.yml'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb31-2"><a href=""></a>    params <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb31-3"><a href=""></a></span>
<span id="cb31-4"><a href=""></a>model_params <span class="op">=</span> params.get(<span class="st">'bounded_confidence_model_1'</span>)</span>
<span id="cb31-5"><a href=""></a>pprint(model_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="monospace">{‘N’: 100, ‘epsilon’: 0.5, ‘grid_height’: 40, ‘grid_width’: 40, ‘max_agent_step_size’: 1, ‘n_iterations’: 1500}</span></p>
</section>
<section id="run-the-model-collect-data" class="slide level2">
<h2>Run the Model &amp; Collect Data</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href=""></a>model <span class="op">=</span> BoundedConfidenceModel(</span>
<span id="cb32-2"><a href=""></a>    grid_width<span class="op">=</span>model_params[<span class="st">'grid_width'</span>],</span>
<span id="cb32-3"><a href=""></a>    grid_height<span class="op">=</span>model_params[<span class="st">'grid_height'</span>],</span>
<span id="cb32-4"><a href=""></a>    N<span class="op">=</span>model_params[<span class="st">'N'</span>],</span>
<span id="cb32-5"><a href=""></a>    epsilon<span class="op">=</span>model_params[<span class="st">'epsilon'</span>],</span>
<span id="cb32-6"><a href=""></a>    max_agent_step_size<span class="op">=</span>model_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb32-7"><a href=""></a>)</span>
<span id="cb32-8"><a href=""></a></span>
<span id="cb32-9"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb32-10"><a href=""></a>    model.step()</span>
<span id="cb32-11"><a href=""></a></span>
<span id="cb32-12"><a href=""></a>results <span class="op">=</span> model.datacollector.get_agent_vars_dataframe().reset_index()</span>
<span id="cb32-13"><a href=""></a>results.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--
```python
#| echo: false
from icsspy.utils import markdown_table
md = markdown_table(results.sample(10), 'tables/_bcm_1.md')
print(md)
```
 -->
</div><div class="column" style="width:25%;">
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Step</th>
<th style="text-align: right;">AgentID</th>
<th style="text-align: right;">Opinion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1220</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.0184829</td>
</tr>
<tr class="even">
<td style="text-align: right;">563</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0134104</td>
</tr>
<tr class="odd">
<td style="text-align: right;">410</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">-0.0145124</td>
</tr>
<tr class="even">
<td style="text-align: right;">668</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">0.0211109</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1087</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">-0.713558</td>
</tr>
<tr class="even">
<td style="text-align: right;">1400</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.0184362</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1100</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">0.0183674</td>
</tr>
<tr class="even">
<td style="text-align: right;">1220</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">-0.713633</td>
</tr>
<tr class="odd">
<td style="text-align: right;">439</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">0.0666911</td>
</tr>
<tr class="even">
<td style="text-align: right;">409</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0.718204</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="plot-opinion-distributions" class="slide level2">
<h2>Plot Opinion Distributions</h2>
<p><br></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href=""></a>grouped <span class="op">=</span> results.groupby(<span class="st">'Step'</span>)</span>
<span id="cb33-2"><a href=""></a></span>
<span id="cb33-3"><a href=""></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-4"><a href=""></a></span>
<span id="cb33-5"><a href=""></a><span class="cf">for</span> name, group <span class="kw">in</span> grouped:</span>
<span id="cb33-6"><a href=""></a>    sns.kdeplot(group[<span class="st">'Opinion'</span>], color<span class="op">=</span><span class="st">'C0'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb33-7"><a href=""></a></span>
<span id="cb33-8"><a href=""></a>plt.xlabel(<span class="st">'</span><span class="ch">\n</span><span class="st">Opinion'</span>)</span>
<span id="cb33-9"><a href=""></a>plt.ylabel(<span class="st">'Density</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb33-10"><a href=""></a>title <span class="op">=</span> <span class="st">"Bounded Confidence Model</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>model_params[<span class="st">'epsilon'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb33-11"><a href=""></a>plt.title(title, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb33-12"><a href=""></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb33-13"><a href=""></a>plt.savefig(<span class="st">'media/bounded-confidence-opinion-distribution-evolution.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<div id="fig-bcmevo" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-bcmevo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/bounded-confidence-opinion-distribution-evolution.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" title="Figure&nbsp;10: A collection of KDE plots showing the evolution of the opinion distribution at each time step in the model."><img data-src="media/bounded-confidence-opinion-distribution-evolution.png" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bcmevo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: A collection of KDE plots showing the evolution of the opinion distribution at each time step in the model.
</figcaption>
</figure>
</div>
</section>
<section id="plot-opinions-over-time" class="slide level2">
<h2>Plot Opinions Over Time</h2>
<p><br></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href=""></a>time_steps <span class="op">=</span> results[<span class="st">'Step'</span>]</span>
<span id="cb34-2"><a href=""></a>opinions <span class="op">=</span> results[<span class="st">'Opinion'</span>]</span>
<span id="cb34-3"><a href=""></a>title <span class="op">=</span> <span class="st">"Bounded Confidence Model</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>model_params[<span class="st">'epsilon'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb34-4"><a href=""></a></span>
<span id="cb34-5"><a href=""></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb34-6"><a href=""></a>sc <span class="op">=</span> plt.scatter(time_steps, opinions, c<span class="op">=</span>opinions, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb34-7"><a href=""></a>cbar <span class="op">=</span> plt.colorbar(sc)</span>
<span id="cb34-8"><a href=""></a>cbar.set_label(<span class="st">'Opinion'</span>)</span>
<span id="cb34-9"><a href=""></a>plt.xlabel(<span class="st">'Time (Steps)'</span>)</span>
<span id="cb34-10"><a href=""></a>plt.ylabel(<span class="st">'Opinion'</span>)</span>
<span id="cb34-11"><a href=""></a>plt.title(title, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb34-12"><a href=""></a>plt.xlim(time_steps.<span class="bu">min</span>(), time_steps.<span class="bu">max</span>())</span>
<span id="cb34-13"><a href=""></a>plt.ylim(<span class="op">-</span><span class="fl">1.01</span>, <span class="dv">1</span>)</span>
<span id="cb34-14"><a href=""></a>plt.savefig(<span class="st">'media/bounded_confidence_epsilon_one_run.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<div id="fig-bounded_confidence_epsilon_one_run" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-bounded_confidence_epsilon_one_run-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/bounded_confidence_epsilon_one_run.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Figure&nbsp;11: Three opinion clusters forming over time in a single run of a BCM with \epsilon = 5. Note the center and two extremes."><img data-src="media/bounded_confidence_epsilon_one_run.png" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bounded_confidence_epsilon_one_run-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Three opinion clusters forming over time in a single run of a BCM with <span class="math inline">\(\epsilon\)</span> = 5. Note the center and two extremes.
</figcaption>
</figure>
</div>
</section>
<section id="experimenting-with-epsilon" class="slide level2">
<h2>Experimenting with <span class="math inline">\(\epsilon\)</span></h2>
<p><br></p>
<p>Lets run the simulation with different <span class="math inline">\(\epsilon\)</span> values (e.g., -1 to 1 in steps) and collect the results in a DataFrame. The DataFrame will include an additional column to track the <span class="math inline">\(\epsilon\)</span> used in each run.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href=""></a><span class="kw">def</span> run_simulation_with_different_epsilons(model_params, epsilon_values):</span>
<span id="cb35-2"><a href=""></a>    all_results <span class="op">=</span> []</span>
<span id="cb35-3"><a href=""></a></span>
<span id="cb35-4"><a href=""></a>    <span class="cf">for</span> epsilon <span class="kw">in</span> epsilon_values:</span>
<span id="cb35-5"><a href=""></a>        model <span class="op">=</span> BoundedConfidenceModel(</span>
<span id="cb35-6"><a href=""></a>            grid_width<span class="op">=</span>model_params[<span class="st">'grid_width'</span>],</span>
<span id="cb35-7"><a href=""></a>            grid_height<span class="op">=</span>model_params[<span class="st">'grid_height'</span>],</span>
<span id="cb35-8"><a href=""></a>            N<span class="op">=</span>model_params[<span class="st">'N'</span>],</span>
<span id="cb35-9"><a href=""></a>            epsilon<span class="op">=</span>epsilon,</span>
<span id="cb35-10"><a href=""></a>            max_agent_step_size<span class="op">=</span>model_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb35-11"><a href=""></a>        )</span>
<span id="cb35-12"><a href=""></a></span>
<span id="cb35-13"><a href=""></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb35-14"><a href=""></a>            model.step()</span>
<span id="cb35-15"><a href=""></a></span>
<span id="cb35-16"><a href=""></a>        epsilon_results <span class="op">=</span> model.datacollector.get_agent_vars_dataframe().reset_index()</span>
<span id="cb35-17"><a href=""></a>        epsilon_results[<span class="st">'Epsilon'</span>] <span class="op">=</span> epsilon  <span class="co"># Add epsilon to track different values</span></span>
<span id="cb35-18"><a href=""></a>        all_results.append(epsilon_results)</span>
<span id="cb35-19"><a href=""></a></span>
<span id="cb35-20"><a href=""></a>    <span class="co"># Combine all results into a single DataFrame</span></span>
<span id="cb35-21"><a href=""></a>    combined_results <span class="op">=</span> pd.concat(all_results, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-22"><a href=""></a>    <span class="cf">return</span> combined_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s run models for the following values and plot the results.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href=""></a>epsilon_values <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]</span>
<span id="cb36-2"><a href=""></a>epsilon_results <span class="op">=</span> run_simulation_with_different_epsilons(</span>
<span id="cb36-3"><a href=""></a>    model_params, epsilon_values</span>
<span id="cb36-4"><a href=""></a>)</span>
<span id="cb36-5"><a href=""></a></span>
<span id="cb36-6"><a href=""></a>epsilon_results.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="experimenting-with-epsilon-1" class="slide level2">
<h2>Experimenting with <span class="math inline">\(\epsilon\)</span></h2>
<!--
```python
#| echo: false
from icsspy.utils import markdown_table
md = markdown_table(epsilon_results.sample(10), 'tables/_bcm_2.md')
print(md)
```
 -->
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Step</th>
<th style="text-align: right;">AgentID</th>
<th style="text-align: right;">Opinion</th>
<th style="text-align: right;">Epsilon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">972</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">0.0367166</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">822</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">-0.667127</td>
<td style="text-align: right;">0.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1294</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0.84525</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1407</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.640566</td>
<td style="text-align: right;">0.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">244</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">0.0902687</td>
<td style="text-align: right;">0.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">1420</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">0.247547</td>
<td style="text-align: right;">0.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.105885</td>
<td style="text-align: right;">0.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">973</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">0.0581587</td>
<td style="text-align: right;">0.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1168</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">0.0581577</td>
<td style="text-align: right;">0.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">1017</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">0.0581493</td>
<td style="text-align: right;">0.8</td>
</tr>
</tbody>
</table>
<!--
```python
#| echo: false
epsilon_results.info()
epsilon_results.to_csv('output/bcm_epsilon_results.csv', index=False)
```
 -->
</section>
<section id="experimenting-with-epsilon-2" class="slide level2">
<h2>Experimenting with <span class="math inline">\(\epsilon\)</span></h2>
<p><br></p>
<p>Let’s create some subplots to compare runs for each of our <span class="math inline">\(\epsilon\)</span> values.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href=""></a>grouped <span class="op">=</span> epsilon_results.groupby(<span class="st">'Epsilon'</span>)</span>
<span id="cb37-2"><a href=""></a></span>
<span id="cb37-3"><a href=""></a>fig, axs <span class="op">=</span> plt.subplots(</span>
<span id="cb37-4"><a href=""></a>    <span class="dv">11</span>, <span class="dv">1</span>,</span>
<span id="cb37-5"><a href=""></a>    figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">30</span>),</span>
<span id="cb37-6"><a href=""></a>    sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb37-7"><a href=""></a>    constrained_layout<span class="op">=</span><span class="va">True</span></span>
<span id="cb37-8"><a href=""></a>)</span>
<span id="cb37-9"><a href=""></a></span>
<span id="cb37-10"><a href=""></a><span class="cf">for</span> (epsilon, group), ax <span class="kw">in</span> <span class="bu">zip</span>(grouped, axs):</span>
<span id="cb37-11"><a href=""></a>    time_steps <span class="op">=</span> group[<span class="st">'Step'</span>]</span>
<span id="cb37-12"><a href=""></a>    opinions <span class="op">=</span> group[<span class="st">'Opinion'</span>]</span>
<span id="cb37-13"><a href=""></a></span>
<span id="cb37-14"><a href=""></a>    sc <span class="op">=</span> ax.scatter(</span>
<span id="cb37-15"><a href=""></a>        time_steps,</span>
<span id="cb37-16"><a href=""></a>        opinions,</span>
<span id="cb37-17"><a href=""></a>        c<span class="op">=</span>opinions,</span>
<span id="cb37-18"><a href=""></a>        cmap<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb37-19"><a href=""></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb37-20"><a href=""></a>        s<span class="op">=</span><span class="dv">10</span></span>
<span id="cb37-21"><a href=""></a>    )</span>
<span id="cb37-22"><a href=""></a></span>
<span id="cb37-23"><a href=""></a>    cbar <span class="op">=</span> fig.colorbar(sc, ax<span class="op">=</span>ax)</span>
<span id="cb37-24"><a href=""></a>    <span class="co"># cbar.set_label('Opinion')</span></span>
<span id="cb37-25"><a href=""></a></span>
<span id="cb37-26"><a href=""></a>    ax.set_title(<span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>epsilon<span class="sc">}</span><span class="ss">"</span>, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb37-27"><a href=""></a></span>
<span id="cb37-28"><a href=""></a>    ax.set_xlim(time_steps.<span class="bu">min</span>(), time_steps.<span class="bu">max</span>())</span>
<span id="cb37-29"><a href=""></a>    ax.set_ylim(<span class="op">-</span><span class="fl">1.01</span>, <span class="dv">1</span>)</span>
<span id="cb37-30"><a href=""></a></span>
<span id="cb37-31"><a href=""></a><span class="co"># custom positions for shared x and y labels</span></span>
<span id="cb37-32"><a href=""></a>fig.text(</span>
<span id="cb37-33"><a href=""></a>    <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.01</span>,</span>
<span id="cb37-34"><a href=""></a>    <span class="st">'Time (Steps)'</span>,</span>
<span id="cb37-35"><a href=""></a>    ha<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb37-36"><a href=""></a>    va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb37-37"><a href=""></a>    fontsize<span class="op">=</span><span class="dv">18</span></span>
<span id="cb37-38"><a href=""></a>)</span>
<span id="cb37-39"><a href=""></a></span>
<span id="cb37-40"><a href=""></a>fig.text(</span>
<span id="cb37-41"><a href=""></a>    <span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.5</span>,</span>
<span id="cb37-42"><a href=""></a>    <span class="st">'Opinion'</span>,</span>
<span id="cb37-43"><a href=""></a>    ha<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb37-44"><a href=""></a>    va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb37-45"><a href=""></a>    rotation<span class="op">=</span><span class="st">'vertical'</span>,</span>
<span id="cb37-46"><a href=""></a>    fontsize<span class="op">=</span><span class="dv">18</span></span>
<span id="cb37-47"><a href=""></a>)</span>
<span id="cb37-48"><a href=""></a></span>
<span id="cb37-49"><a href=""></a>plt.savefig(<span class="st">'media/epsilon_comparison_one_run.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<div id="fig-epsilon_comparison_one_run" class="quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-epsilon_comparison_one_run-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="media/epsilon_comparison_one_run.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Figure&nbsp;12: Results of a parameter sweep on \epsilon. Note tendencies towards fragmentation, polarization, and consensus at different \epsilon values."><img data-src="media/epsilon_comparison_one_run.png" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-epsilon_comparison_one_run-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Results of a parameter sweep on <span class="math inline">\(\epsilon\)</span>. Note tendencies towards fragmentation, polarization, and consensus at different <span class="math inline">\(\epsilon\)</span> values.
</figcaption>
</figure>
</div>
</section></section>
<section>
<section id="reduction-realism" class="title-slide slide level1 center">
<h1>Reduction &amp; Realism</h1>

</section>
<h4 id="model-tradeoffs">Model Tradeoffs</h4>
<ul>
<li>all models <strong>reduce</strong>, but by how much?</li>
<li>tension between simple theoretical models on the one hand, and complex rich models on the other.
<ul>
<li>Fine-grained vs.&nbsp;coarse-grained Models <span class="nord-light"><span class="citation" data-cites="bruch2015agent smaldino2023modeling">(<a href="#/section-16" role="doc-biblioref" onclick="">Bruch and Atwell 2015</a>; <a href="#/section-16" role="doc-biblioref" onclick="">Smaldino 2023</a>)</span></span></li>
<li>empirical data and calibration; Bayesian inference</li>
</ul></li>
</ul>
<h4 id="whats-hot-now">What’s hot now?</h4>
<ul>
<li>more realistic and empirically-calibrated models of:
<ul>
<li>agent cognition, emotion, identity, and decision-making</li>
<li>network structure, population dynamics</li>
</ul></li>
<li>more sophisticated modelling of stochastic dynamics</li>
<li>multiple opinions at once</li>
<li>external / exogenous factors</li>
</ul>
<!-- CUTTING -- OUT OF TIME TO FINISH THIS AND IT'S A LOT ANYWAY -->
<!-- _day-5-copenhagen-networks-study-sbm.qmd -->
<section id="section-15" class="slide level2">
<h2></h2>
<p>That’s all for now!</p>
</section></section>
<section>
<section id="references" class="title-slide slide level1 center">
<h1>References</h1>

</section>
<section id="section-16" class="slide level2 smaller scrollable">
<h2></h2>
<div class="quarto-auto-generated-content">
<p><img src="media/logo_gesis.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><span class="nord-footer">CC BY-SA 4.0</span></p>
</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bruch2015agent" class="csl-entry" role="listitem">
Bruch, Elizabeth, and Jon Atwell. 2015. <span>“Agent-Based Models in Empirical Social Research.”</span> <em>Sociological Methods &amp; Research</em> 44 (2): 186–221.
</div>
<div id="ref-crooks2018agent" class="csl-entry" role="listitem">
Crooks, Andrew, Alison Heppenstall, Ed Manley, and Nick Malleson. 2018. <span>“Agent-Based Modelling and Geographical Information Systems: A Practical Primer.”</span>
</div>
<div id="ref-grimm2010odd" class="csl-entry" role="listitem">
Grimm, Volker, Uta Berger, Donald L DeAngelis, J Gary Polhill, Jarl Giske, and Steven F Railsback. 2010. <span>“The ODD Protocol: A Review and First Update.”</span> <em>Ecological Modelling</em> 221 (23): 2760–68.
</div>
<div id="ref-macy2002factors" class="csl-entry" role="listitem">
Macy, Michael, and Robert Willer. 2002. <span>“From Factors to Actors: Computational Sociology and Agent-Based Modeling.”</span> <em>Annual Review of Sociology</em> 28 (1): 143–66.
</div>
<div id="ref-railsback2019agent" class="csl-entry" role="listitem">
Railsback, Steven, and Volker Grimm. 2019. <em>Agent-Based and Individual-Based Modeling: A Practical Introduction</em>. Princeton university press.
</div>
<div id="ref-smaldino2023modeling" class="csl-entry" role="listitem">
Smaldino, Paul. 2023. <em>Modeling Social Behavior: Mathematical and Agent-Based Models of Social Dynamics and Cultural Evolution</em>. Princeton University Press.
</div>
<div id="ref-squazzoni2012agent" class="csl-entry" role="listitem">
Squazzoni, Flaminio. 2012. <em>Agent-Based Computational Sociology</em>. John Wiley &amp; Sons.
</div>
<div id="ref-wilensky2015introduction" class="csl-entry" role="listitem">
Wilensky, Uri, and William Rand. 2015. <em>An Introduction to Agent-Based Modeling: Modeling Natural, Social, and Engineered Complex Systems with NetLogo</em>. MIT press.
</div>
</div>
</section></section>
<section id="footnotes" class="footnotes footnotes-end-of-document smaller scrollable" role="doc-endnotes"><h2>Footnotes</h2>

<ol>
<li id="fn1"><p>If <span class="math inline">\(R\)</span> is “removed” instead of “recovered” … there is no recovery.</p></li>
<li id="fn2"><p>This is an additional step, not necessarily part of a sensitivity analysis but often done alongside.</p></li>
<li id="fn3"><p>It takes a couple of minutes to run on my MacBook Air.</p></li>
</ol>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="day-5_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="day-5_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="day-5_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="day-5_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","selector":".lightbox","loop":false,"openEffect":"zoom"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>